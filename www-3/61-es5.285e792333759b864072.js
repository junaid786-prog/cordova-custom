function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(n,e){for(var t=0;t<e.length;t++){var l=e[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(n,l.key,l)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),t&&_defineProperties(n,t),n}(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{pXS3:function(n,e,t){"use strict";t.r(e);var l=t("8Y7J"),o=t("mrSG"),i=t("ZZ/e"),r=t("J7vL"),u=t("OUMn"),c="Coupons",s="RegionCode",a=function(){function n(e,t,l,i,r,u){var a=this;_classCallCheck(this,n),this.couponsService=e,this.navCtrl=t,this.popupCtrl=l,this.translate=i,this.storage=r,this.zone=u,this.regionText="",this.regions=[],this.regionCodes=[],this.onCouponClicked=function(n,e){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function t(){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.redeemed()&&!e.expired()){t.next=5;break}this.onCouponInfoClicked(n,e),t.next=8;break;case 5:return l={state:{title:e.title,desc:e.desc,code:e.code,qrcode:e.qrCode()}},t.next=8,this.navCtrl.navigateForward("/coupon-code",l);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})))},this.onCouponInfoClicked=function(n,e){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t={state:{tc:e.tc,redeemedAt:e.redeemedAt,expiredAt:e.expiredAt}},n.next=4,this.navCtrl.navigateForward("/coupon-info",t);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),console.log(n.t0);case 9:case"end":return n.stop()}}),n,this,[[0,6]])})))},this.reloadCoupons=function(){a.infiniteScroll.disabled=!1,a.coupons=[],a.loadCoupons(null)},this.loadCoupons=function(n){a.downloadCoupons(a.coupons.length>0?a.coupons[a.coupons.length-1].issuedAt:new Date,a.currentRegionCode)},this.downloadCoupons=function(n,e){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function t(){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.couponsService.getCoupons(n,10,e);case 3:l=t.sent,this.coupons=this.coupons.concat(l),this.infiniteScroll.complete(),10!=l.length&&(this.infiniteScroll.disabled=!0),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.infiniteScroll.complete(),this.infiniteScroll.disabled=!0;case 10:this.virtualScroll.checkEnd();case 11:case"end":return t.stop()}}),t,this,[[0,7]])})))},this.regionClicked=function(){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function n(){var e,t=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(e=[]).push({name:"regions",options:this.popupCtrl.getColumnOptions(this.regions),selectedIndex:this.getRegionIndex(this.currentRegionCode)}),this.popupCtrl.presentNativePickerController(e,(function(n){return o.b(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.zone.run((function(){var e=n[0].description;t.regionText=e,t.currentRegionCode=t.getRegionCode(e),t.saveLastRegionCode(t.currentRegionCode),t.reloadCoupons()}))}catch(l){console.log(l)}case 1:case"end":return e.stop()}}),e,this)})))}));case 2:case"end":return n.stop()}}),n,this)})))},this.loadLastRegionCode=function(){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e="HKG",n.prev=1,n.next=4,this.storage.get(this.getKey(s));case 4:if(n.t0=e=n.sent,null!=n.t0){n.next=7;break}return n.abrupt("return","HKG");case 7:n.next=12;break;case 9:n.prev=9,n.t1=n.catch(1),console.log(n.t1);case 12:return n.abrupt("return",e);case 13:case"end":return n.stop()}}),n,this,[[1,9]])})))},this.saveLastRegionCode=function(n){return o.b(a,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.storage.set(this.getKey(s),n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})))},this.getRegionCode=function(n){return Object.keys(a.regionInfo).find((function(e){return a.regionInfo[e]===n}))},this.getRegionIndex=function(n){return a.regionCodes.findIndex((function(e){return e===n}))},this.getKey=function(n){return c+"-"+n}}return _createClass(n,[{key:"ngOnInit",value:function(){this.regionInfo=this.translate.instant("region"),this.regions=Object.values(this.regionInfo),this.regionCodes=Object.keys(this.regionInfo)}},{key:"ionViewWillEnter",value:function(){return o.b(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.loadLastRegionCode().then((function(n){e.currentRegionCode=n,e.regionText=e.translate.instant("region.".concat(n)),e.reloadCoupons()}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"ionViewDidEnter",value:function(){}},{key:"ionViewWillLeave",value:function(){}},{key:"ionViewDidLeave",value:function(){}}]),n}(),p=function n(){_classCallCheck(this,n)},b=t("pMnS"),d=t("SVse"),g=t("oBZk"),h=t("TSSN"),f=t("xgBC"),x=l.Ab({encapsulation:0,styles:[[".coupon[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;padding:10px 0;width:100%}.redeemed[_ngcontent-%COMP%]{opacity:.4}.not-redeemed[_ngcontent-%COMP%]{opacity:1}.coupon-left[_ngcontent-%COMP%]{background:url(coupon-01.b04d2eef4044a80b81cb.png) no-repeat;width:8px;height:196px}.coupon-left-body[_ngcontent-%COMP%]{background:url(coupon-04.3ef93221d0ac83eb2c52.png) repeat-x;width:18%;height:196px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:start;justify-content:start;-webkit-box-align:center;align-items:center}.coupon-left-text-container[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%}.coupon-left-text[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:30px;font-weight:700;-webkit-writing-mode:vertical-rl;-ms-writing-mode:tb-rl;writing-mode:vertical-rl;-webkit-text-orientation:mixed;text-orientation:mixed;text-align:center;white-space:pre-wrap}.coupon-mid[_ngcontent-%COMP%]{background:url(coupon-02.27518f05f88f344b277a.png) no-repeat;width:31px;height:196px}.coupon-right-body[_ngcontent-%COMP%]{background:url(coupon-04.3ef93221d0ac83eb2c52.png) repeat-x;width:calc(100% - 20% - 20px - 20px - 8px - 31px - 9px);height:196px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;padding:5px}.coupon-title[_ngcontent-%COMP%]{color:var(--solos-color-d);width:100%;font-size:20px;text-align:center;padding:2px;border-width:1px;border-color:var(--solos-color-d);border-style:dashed}.coupon-desc[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:12px;line-height:17px;height:100%;padding:5px 0;white-space:pre-wrap}.coupon-footer[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;width:100%}.coupon-num-exp[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:9px;line-height:12px;width:100%;font-weight:100}.qrcode-icon[_ngcontent-%COMP%]{margin:5px;width:22px;height:22px}.info-icon[_ngcontent-%COMP%]{align-self:flex-start;margin-bottom:15px;margin-left:5px;width:22px;height:22px}.coupon-right[_ngcontent-%COMP%]{background:url(coupon-03.8f62eda0e2fb364a4d99.png) no-repeat;width:9px;height:196px}"]],data:{}});function m(n){return l.Xb(0,[(n()(),l.Cb(0,0,null,null,26,"div",[["class","coupon"]],null,null,null,null,null)),l.Sb(512,null,d.u,d.v,[l.x,l.y,l.p,l.L]),l.Bb(2,278528,null,0,d.j,[d.u],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(n()(),l.Cb(3,0,null,null,0,"div",[["class","coupon-left"]],null,null,null,null,null)),(n()(),l.Cb(4,0,null,null,5,"div",[["class","coupon-left-body"]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.onCouponInfoClicked(t,n.context.$implicit)&&l),l}),null,null)),(n()(),l.Cb(5,0,null,null,2,"div",[["class","coupon-left-text-container"]],null,null,null,null,null)),(n()(),l.Cb(6,0,null,null,1,"div",[["class","coupon-left-text"]],null,null,null,null,null)),(n()(),l.Vb(7,null,[" "," "])),(n()(),l.Cb(8,0,null,null,1,"ion-icon",[["class","info-icon"],["slot","icon-only"],["src","assets/imgs/coupon-06.svg"]],null,null,null,g.R,g.j)),l.Bb(9,49152,null,0,i.E,[l.j,l.p,l.F],{src:[0,"src"]},null),(n()(),l.Cb(10,0,null,null,0,"div",[["class","coupon-mid"]],null,null,null,null,null)),(n()(),l.Cb(11,0,null,null,14,"div",[["class","coupon-right-body"]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.onCouponClicked(t,n.context.$implicit)&&l),l}),null,null)),(n()(),l.Cb(12,0,null,null,1,"div",[["class","coupon-title"]],null,null,null,null,null)),(n()(),l.Vb(13,null,[" "," "])),(n()(),l.Cb(14,0,null,null,1,"div",[["class","coupon-desc"]],null,null,null,null,null)),(n()(),l.Vb(15,null,[" "," "])),(n()(),l.Cb(16,0,null,null,9,"div",[["class","coupon-footer"]],null,null,null,null,null)),(n()(),l.Cb(17,0,null,null,6,"div",[["class","coupon-num-exp"]],null,null,null,null,null)),(n()(),l.Vb(18,null,[" ","\xa0"," "])),l.Pb(131072,h.j,[h.k,l.j]),(n()(),l.Cb(20,0,null,null,0,"br",[],null,null,null,null,null)),(n()(),l.Vb(21,null,[" ","\xa0"," "])),l.Pb(131072,h.j,[h.k,l.j]),l.Rb(23,2),(n()(),l.Cb(24,0,null,null,1,"ion-icon",[["class","qrcode-icon"],["slot","icon-only"],["src","assets/imgs/coupon-05.svg"]],null,null,null,g.R,g.j)),l.Bb(25,49152,null,0,i.E,[l.j,l.p,l.F],{src:[0,"src"]},null),(n()(),l.Cb(26,0,null,null,0,"div",[["class","coupon-right"]],null,null,null,null,null))],(function(n,e){var t=e.context.$implicit.redeemed()||e.context.$implicit.expired()?"redeemed":"not-redeemed";n(e,2,0,"coupon",t),n(e,9,0,"assets/imgs/coupon-06.svg"),n(e,25,0,"assets/imgs/coupon-05.svg")}),(function(n,e){n(e,7,0,e.context.$implicit.discountHighlight),n(e,13,0,e.context.$implicit.title),n(e,15,0,e.context.$implicit.desc),n(e,18,0,l.Wb(e,18,0,l.Ob(e,19).transform("coupon.coupon-num")),e.context.$implicit.code);var t=l.Wb(e,21,0,l.Ob(e,22).transform("coupon.exp")),o=l.Wb(e,21,1,n(e,23,0,l.Ob(e.parent,0),e.context.$implicit.expiredAt,"dd LLL yy"));n(e,21,0,t,o)}))}function v(n){return l.Xb(0,[l.Pb(0,d.d,[l.z]),l.Tb(671088640,1,{virtualScroll:0}),l.Tb(671088640,2,{infiniteScroll:0}),(n()(),l.Cb(3,0,null,null,12,"ion-header",[],null,null,null,g.Q,g.i)),l.Bb(4,49152,null,0,i.D,[l.j,l.p,l.F],null,null),(n()(),l.Cb(5,0,null,0,10,"ion-toolbar",[["class","settings-header-background"],["mode","ios"]],null,null,null,g.ob,g.G)),l.Bb(6,49152,null,0,i.Db,[l.j,l.p,l.F],{mode:[0,"mode"]},null),(n()(),l.Cb(7,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,g.L,g.d)),l.Bb(8,49152,null,0,i.n,[l.j,l.p,l.F],null,null),(n()(),l.Cb(9,0,null,0,2,"ion-back-button",[["class","settings-back-button"],["text",""]],null,[[null,"click"]],(function(n,e,t){var o=!0;return"click"===e&&(o=!1!==l.Ob(n,11).onClick(t)&&o),o}),g.J,g.b)),l.Bb(10,49152,null,0,i.i,[l.j,l.p,l.F],{text:[0,"text"]},null),l.Bb(11,16384,null,0,i.j,[[2,i.jb],i.Jb],null,null),(n()(),l.Cb(12,0,null,0,3,"ion-title",[["class","settings-header-title"]],null,null,null,g.mb,g.E)),l.Bb(13,49152,null,0,i.Bb,[l.j,l.p,l.F],null,null),(n()(),l.Vb(14,0,["",""])),l.Pb(131072,h.j,[h.k,l.j]),(n()(),l.Cb(16,0,null,null,21,"ion-content",[["class","app-background"]],null,null,null,g.O,g.g)),l.Bb(17,49152,null,0,i.w,[l.j,l.p,l.F],null,null),(n()(),l.Cb(18,0,null,0,8,"ion-item",[["button",""],["class","settings-item"],["detail",""]],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.regionClicked()&&l),l}),g.W,g.o)),l.Bb(19,49152,null,0,i.J,[l.j,l.p,l.F],{button:[0,"button"],detail:[1,"detail"]},null),(n()(),l.Cb(20,0,null,0,3,"ion-label",[["color","settings-left-label"]],null,null,null,g.X,g.p)),l.Bb(21,49152,null,0,i.P,[l.j,l.p,l.F],{color:[0,"color"]},null),(n()(),l.Vb(22,0,["",""])),l.Pb(131072,h.j,[h.k,l.j]),(n()(),l.Cb(24,0,null,0,2,"ion-label",[["class","ion-text-right"],["color","settings-right-label"]],null,null,null,g.X,g.p)),l.Bb(25,49152,null,0,i.P,[l.j,l.p,l.F],{color:[0,"color"]},null),(n()(),l.Vb(26,0,["",""])),(n()(),l.Cb(27,0,null,0,6,"ion-virtual-scroll",[["approxItemHeight","210px"]],null,null,null,g.pb,g.H)),l.Bb(28,835584,[[1,4],["virtualScroll",4]],3,i.Eb,[l.F,l.x,l.p],{approxItemHeight:[0,"approxItemHeight"],items:[1,"items"]},null),l.Tb(335544320,3,{itmTmp:0}),l.Tb(335544320,4,{hdrTmp:0}),l.Tb(335544320,5,{ftrTmp:0}),(n()(),l.rb(16777216,null,0,1,null,m)),l.Bb(33,16384,[[3,4]],0,i.Rb,[l.T,l.X],null,null),(n()(),l.Cb(34,0,null,0,3,"ion-infinite-scroll",[["threshold","100px"]],null,[[null,"ionInfinite"]],(function(n,e,t){var l=!0;return"ionInfinite"===e&&(l=!1!==n.component.loadCoupons(t)&&l),l}),g.U,g.l)),l.Bb(35,49152,[[2,4],["infiniteScroll",4]],0,i.G,[l.j,l.p,l.F],{threshold:[0,"threshold"]},null),(n()(),l.Cb(36,0,null,0,1,"ion-infinite-scroll-content",[["loadingSpinner","bubbles"]],null,null,null,g.T,g.m)),l.Bb(37,49152,null,0,i.H,[l.j,l.p,l.F],{loadingSpinner:[0,"loadingSpinner"]},null)],(function(n,e){var t=e.component;n(e,6,0,"ios"),n(e,10,0,""),n(e,19,0,"",""),n(e,21,0,"settings-left-label"),n(e,25,0,"settings-right-label"),n(e,28,0,"210px",t.coupons),n(e,35,0,"100px"),n(e,37,0,"bubbles")}),(function(n,e){var t=e.component;n(e,14,0,l.Wb(e,14,0,l.Ob(e,15).transform("coupon.coupon"))),n(e,22,0,l.Wb(e,22,0,l.Ob(e,23).transform("global.region"))),n(e,26,0,t.regionText)}))}var C=l.yb("app-coupons",a,(function(n){return l.Xb(0,[(n()(),l.Cb(0,0,null,null,1,"app-coupons",[],null,null,null,v,x)),l.Bb(1,114688,null,0,a,[r.a,i.Jb,u.a,h.k,f.b,l.F],null,null)],(function(n,e){n(e,1,0)}),null)}),{},{},[]),k=t("s7LF"),w=t("iInd");t.d(e,"CouponsPageModuleNgFactory",(function(){return y}));var y=l.zb(p,[],(function(n){return l.Lb([l.Mb(512,l.m,l.kb,[[8,[b.a,C]],[3,l.m],l.D]),l.Mb(4608,d.n,d.m,[l.z,[2,d.z]]),l.Mb(4608,k.j,k.j,[]),l.Mb(4608,i.c,i.c,[l.F,l.g]),l.Mb(4608,i.Ib,i.Ib,[i.c,l.m,l.w]),l.Mb(4608,i.Nb,i.Nb,[i.c,l.m,l.w]),l.Mb(4608,h.g,h.f,[]),l.Mb(4608,h.c,h.e,[]),l.Mb(4608,h.i,h.d,[]),l.Mb(4608,h.b,h.a,[]),l.Mb(4608,h.k,h.k,[h.l,h.g,h.c,h.i,h.b,h.m,h.n]),l.Mb(1073742336,d.b,d.b,[]),l.Mb(1073742336,k.i,k.i,[]),l.Mb(1073742336,k.b,k.b,[]),l.Mb(1073742336,i.Fb,i.Fb,[]),l.Mb(1073742336,h.h,h.h,[]),l.Mb(1073742336,w.o,w.o,[[2,w.t],[2,w.m]]),l.Mb(1073742336,p,p,[]),l.Mb(256,h.n,void 0,[]),l.Mb(256,h.m,void 0,[]),l.Mb(1024,w.k,(function(){return[[{path:"",component:a}]]}),[])])}))}}]);