function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(n):a.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(t);if(e){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"6gT1":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return u}));var i=n("mrSG"),a=(n("ZZ/e"),n("lIDq")),r=n("lvyt");n("Z18M"),n("OUMn");var s=16,c=function(t){return t[t.CURRENT=0]="CURRENT",t[t.START=1]="START",t[t.STOP=2]="STOP",t}({}),o=function(){function t(e,n,a,r,o,u,h){var l=this;_classCallCheck(this,t),this.route=e,this.router=n,this.coachSettings=a,this.backend=r,this.navCtrl=o,this.translate=u,this.popupCtrl=h,this.startDate="",this.startTime="",this.elapsedHH=0,this.elapsedmm=0,this.elapsedss=0,this.distance=0,this.avgPacingmm=-1,this.avgPacingss=-1,this.maxPacingmm=-1,this.maxPacingss=-1,this.minPacingmm=-1,this.minPacingss=-1,this.movingHH=0,this.movingmm=0,this.movingss=0,this.stepCount=0,this.calories=0,this.avgStride=-1,this.maxStride=-1,this.minStride=-1,this.avgCadence=-1,this.maxCadence=-1,this.minCadence=-1,this.leftBal=0,this.rightBal=0,this.avgHeartRate=-1,this.minHeartRate=-1,this.maxHeartRate=-1,this.pacingUnit="summary.per-km",this.distanceUnit="summary.km",this.strideUnit="summary.m",this.runningRoute=null,this.calculatedRoutes=[],this.markers=[],this.map=null,this.isImperial=!1,this.deleteActivity=function(){return i.b(l,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.activity.activityId){t.next=9;break}return t.prev=1,t.next=4,this.popupCtrl.presentActionSheet({buttons:[{text:this.translate.instant("summary.delete-activity"),role:"destructive",handler:function(){e.backend.removeActivity(e.activity.activityId).then((function(){e.navCtrl.pop()})).catch((function(t){e.navCtrl.pop()}))}},{text:this.translate.instant("global.cancel"),role:"cancel"}]},!0);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.log(t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,6]])})))},this.showRecycleBin=function(){return null!=l.activity.activityId},this.openMap=function(){return i.b(l,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.map&&this.runningRoute.length>0)try{this.map=new google.maps.Map(this.mapCanvas.nativeElement,{center:{lat:this.runningRoute[0].lat,lng:this.runningRoute[0].lng},zoom:s,disableDefaultUI:!0}),this.updateRouteDisplay()}catch(e){console.log(e)}case 1:case"end":return t.stop()}}),t,this)})))},this.closeMap=function(){null!=l.map&&(l.deleteRoute(),l.map=null)},this.deleteRoute=function(){l.deleteMarkers();var t,e=_createForOfIteratorHelper(l.calculatedRoutes);try{for(e.s();!(t=e.n()).done;){t.value.setMap(null)}}catch(n){e.e(n)}finally{e.f()}l.calculatedRoutes=[]},this.addMarker=function(t,e){var n;switch(e){case c.CURRENT:n="assets/imgs/blue-dot.png";break;case c.START:n="assets/imgs/green-dot.png";break;case c.STOP:default:n="assets/imgs/red-dot.png"}if(null!=l.map){var i=new google.maps.Marker({map:l.map,position:t,icon:{url:n}});l.markers.push(i)}},this.deleteMarkers=function(){var t,e=_createForOfIteratorHelper(l.markers);try{for(e.s();!(t=e.n()).done;){t.value.setMap(null)}}catch(n){e.e(n)}finally{e.f()}l.markers.length=0},this.drawPathOnMap=function(t,e){var n="#AA00FF";e||(n="#C0C0C0");var i=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:n,strokeOpacity:1,strokeWeight:2});i.setMap(l.map),l.calculatedRoutes.push(i)},this.updateRouteDisplay=function(){if(null!=l.map){var t,e=new google.maps.LatLngBounds,n=[],i=!1,a=null,r=null,s=_createForOfIteratorHelper(l.runningRoute);try{for(s.s();!(t=s.n()).done;){var o=t.value;null==o.paused&&(o.paused=!1),null==a&&(a=o),r=o,n.push({lat:o.lat,lng:o.lng}),e.extend(new google.maps.LatLng(o.lat,o.lng)),i!=o.paused&&(l.drawPathOnMap(n,!i),n=[o],i=o.paused)}}catch(u){s.e(u)}finally{s.f()}n.length>1&&l.drawPathOnMap(n,!i),l.calculatedRoutes.length>0?(l.addMarker(a,c.START),l.addMarker(r,c.STOP),l.map.fitBounds(e)):l.addMarker(n[0],c.CURRENT)}},this.route.queryParams.subscribe((function(t){l.router.getCurrentNavigation().extras.state&&(l.activity=l.router.getCurrentNavigation().extras.state.activity)}))}return _createClass(t,[{key:"ngOnInit",value:function(){this.startDate=Object(r.b)(this.activity.startTime)+" "+Object(r.a)(this.activity.startTime),this.startTime=Object(r.d)(this.activity.startTime),this.coachSettings.getUnit()==a.d&&(this.pacingUnit="summary.per-mi",this.distanceUnit="summary.mile",this.strideUnit="summary.feet",this.isImperial=!0);var t=this.activity.elapsedTime;this.elapsedss=Math.floor(t%60),this.elapsedmm=Math.floor(t/60)%60,this.elapsedHH=Math.floor(t/3600),this.distance=this.activity.distance,this.isImperial&&(this.distance*=.62137);var e=this.activity.avgPacing,n=this.activity.maxPacing,i=this.activity.minPacing;this.isImperial&&(e/=.62137,n/=.62137,i/=.62137),this.avgPacingmm=Math.floor(e),this.avgPacingss=Math.floor(e%1*60),this.maxPacingmm=Math.floor(n),this.maxPacingss=Math.floor(n%1*60),this.minPacingmm=Math.floor(i),this.minPacingss=Math.floor(i%1*60);var s=this.activity.movingTime;this.movingss=Math.floor(s%60),this.movingmm=Math.floor(s/60)%60,this.movingHH=Math.floor(s/3600),this.stepCount=this.activity.stepCount,this.calories=this.activity.calories,this.avgStride=this.activity.avgStride,this.maxStride=this.activity.maxStride,this.minStride=this.activity.minStride,this.isImperial&&(this.avgStride*=3.2808,this.maxStride*=3.2808,this.minStride*=3.2808),this.avgCadence=this.activity.avgCadence,this.maxCadence=this.activity.maxCadence,this.minCadence=this.activity.minCadence,this.leftBal=this.activity.leftBalance,this.rightBal=this.activity.rightBalance,this.avgHeartRate=this.activity.avgHeartRate,this.minHeartRate=this.activity.minHeartRate,this.maxHeartRate=this.activity.maxHeartRate,this.runningRoute=this.activity.route}},{key:"ionViewDidEnter",value:function(){this.openMap()}},{key:"ionViewWillLeave",value:function(){this.closeMap()}}]),t}(),u=function t(){_classCallCheck(this,t),this.activityId=null,this.startTime=null,this.distance=0,this.elapsedTime=0,this.avgPacing=0,this.maxPacing=0,this.minPacing=0,this.movingTime=0,this.stepCount=0,this.calories=0,this.avgStride=0,this.maxStride=0,this.minStride=0,this.avgCadence=0,this.maxCadence=0,this.minCadence=0,this.leftBalance=0,this.rightBalance=0,this.avgHeartRate=0,this.minHeartRate=0,this.maxHeartRate=0,this.route=[]}},"6mIw":function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return o}));var i=n("mrSG"),a=n("lGdP"),r=n("R3bG"),s=n("yDgC"),c=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a,r){var s;return _classCallCheck(this,n),(s=e.call(this,t,!0,!0,!1)).maxNodAngle=i,s.maxNodTime=a,s.pitchReference=r,s}return n}(a.k),o=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,s,c,o,u,h,l,g,d){var p;return _classCallCheck(this,n),(p=e.call(this,s,c,o,u,h,l,g,d)).acceDataXArray=[],p.acceDataYArray=[],p.acceDataZArray=[],p.clearAcceData=function(){p.acceDataXArray=[],p.acceDataYArray=[],p.acceDataZArray=[]},p.handleGAMBack=function(t){return i.b(_assertThisInitialized(p),void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(new Date).getTime(),0!=this.lastTimeStamp){e.next=3;break}return e.abrupt("return",void(this.lastTimeStamp=n));case 3:i=n-this.lastTimeStamp,this.lastTimeStamp=n,a=t.acceDataX,r=t.acceDataY,this.acceDataXArray.push(t.acceDataZ),this.acceDataYArray.push(-r),this.acceDataZArray.push(a),this.timerset.update(i);case 7:case"end":return e.stop()}}),e,this)})))},p.processPostureData=function(){return i.b(_assertThisInitialized(p),void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=this.acceDataXArray.length&&0!=this.acceDataYArray.length&&0!=this.acceDataZArray.length){t.next=2;break}return t.abrupt("return");case 2:this.acceDataXArray.reduce((function(t,e){return t+e}),0),e=this.acceDataYArray.reduce((function(t,e){return t+e}),0)/this.acceDataYArray.length,n=this.acceDataZArray.reduce((function(t,e){return t+e}),0)/this.acceDataZArray.length,this.clearAcceData(),i=Math.atan(e/n),i*=180/Math.PI,this.cfg.pitchReference-i<this.cfg.maxNodAngle?(this.correctPostureCnt++,this.instantIncorrectPostureCnt=0):(this.incorrectPostureCnt++,this.instantIncorrectPostureCnt++,this.instantIncorrectPostureCnt>=this.cfg.maxNodTime&&(this.instantIncorrectPostureCnt=0,this.getState()==a.i.Started&&(this.audioPlayer.flushPendingSpeech4tag(a.h),this.audioPlayer.speech(!0,this.translate.instant("training.keep-look-forward"),a.h))));case 7:case"end":return t.stop()}}),t,this)})))},p.startGAM=function(){p.events.subscribe(r.c,p.handleGAMBack),p.solosConnector.startGAM().then((function(){})).catch((function(t){console.log(t)}))},p.stopGAM=function(){p.events.unsubscribe(r.c,p.handleGAMBack),p.solosConnector.stopGAM().then((function(){})).catch((function(t){console.log(t)}))},p.cfg=t,p}return _createClass(n,[{key:"start",value:function(t){return!!_get(_getPrototypeOf(n.prototype),"start",this).call(this,t)&&(this.lastTimeStamp=0,this.instantIncorrectPostureCnt=0,this.correctPostureCnt=0,this.incorrectPostureCnt=0,this.clearAcceData(),this.timerset=new s.a,this.timerset.addTimer(this.processPostureData,1e3),!0)}},{key:"coachMetricDataChanged",value:function(){_get(_getPrototypeOf(n.prototype),"coachMetricDataChanged",this).call(this),this.events.publish(a.a,this.getCoachMetricData())}},{key:"getCoachMetricData",value:function(){return{movingTime:this.movingTime,distance:this.distance,correctPostureCnt:this.correctPostureCnt,incorrectPostureCnt:this.incorrectPostureCnt}}},{key:"coachStarted",value:function(){this.startGAM(),_get(_getPrototypeOf(n.prototype),"coachStarted",this).call(this)}},{key:"coachPaused",value:function(){this.stopGAM(),_get(_getPrototypeOf(n.prototype),"coachPaused",this).call(this)}},{key:"coachStopped",value:function(){this.stopGAM(),_get(_getPrototypeOf(n.prototype),"coachStopped",this).call(this)}},{key:"stopped",value:function(){var t=this,e=this.getSpokenTextWithMovingTime();this.audioPlayer.speech(!1,e),e=this.getSpokenTextTotalDistance(),this.audioPlayer.speech(!1,e),e=this.translate.instant("training.correct-posture-percent",{value:(this.correctPostureCnt+this.incorrectPostureCnt?100*this.correctPostureCnt/(this.correctPostureCnt+this.incorrectPostureCnt):0).toFixed(0)}),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}}]),n}(a.j)},BHc3:function(t,e,n){"use strict";var i=n("mrSG"),a=n("ZZ/e"),r=n("R3bG"),s=n("lIDq"),c=n("A5kO"),o=n("yDgC"),u=n("8qa8"),h=n("Z18M"),l=n("nJKE"),g=n("6gT1"),d=n("yM5c"),p=n("AGLQ"),f=n("PEy0"),m=n("uUwQ"),v=n("DaA9"),R=n("cPjO"),S=n("yYM5"),y=n("4SHv"),T=n("lvyt"),C=n("3Cwc"),b=n("ppcj"),k=function t(e,n){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;_classCallCheck(this,t),this.append=function(t){a.logBuffer+=t+"\r\n",null===a.saveTimer&&(a.saveTimer=setTimeout(a.saveToFile,a.saveIntervalMS))},this.saveToFile=function(){return i.b(a,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,t.t0=0!=this.logBuffer.length,!t.t0){t.next=6;break}return t.next=5,this.file.appendTextFile(this.filename,this.logBuffer);case 5:this.logBuffer="";case 6:this.saveTimer=null,t.next=12;break;case 9:t.prev=9,t.t1=t.catch(0),console.log(t.t1);case 12:case"end":return t.stop()}}),t,this,[[0,9]])})))},this.file=e,this.filename=n,this.saveIntervalMS=r,this.logBuffer="",this.saveTimer=null},P=n("8Y7J"),x=n("TSSN");n.d(e,"i",(function(){return D})),n.d(e,"f",(function(){return w})),n.d(e,"e",(function(){return _})),n.d(e,"g",(function(){return A})),n.d(e,"h",(function(){return O})),n.d(e,"c",(function(){return I})),n.d(e,"d",(function(){return L})),n.d(e,"j",(function(){return Rt})),n.d(e,"a",(function(){return St})),n.d(e,"b",(function(){return Tt}));var M,D="evtCoachStateChanged",w="evtCoachMetricChanged",_="evtCoachHeartRateChanged",A="evtCoachOneSecondTimer",O="evtCoachRouteChanged",I="evtCoachActivitySaved",L="evtCoachExternalReminder",B="AICoachRecord-",H=".ai",F=".strava",U="tagSpeechAICoachReminder",G=6e4,W=!1,E=!1,N=!1,Z=!1,K=!1,j=-1,Y=-1,X=-1,V=0,q=-1,J=0,Q=0,z=0,$=0,tt=-1,et=-1,nt=-1,it=0,at=0,rt=0,st=0,ct=0,ot=0,ut=0,ht=0,lt=0,gt=0,dt=800,pt=2,ft=5,mt=function(t){return t[t.Start=0]="Start",t[t.Stop=1]="Stop",t[t.Pause=2]="Pause",t[t.PauseOnDisconnect=3]="PauseOnDisconnect",t[t.Resume=4]="Resume",t[t.ResumeOnConnect=5]="ResumeOnConnect",t}({}),vt=function t(e,n){_classCallCheck(this,t),this.type=e,this.para=n},Rt=function(t){return t[t.Idle=0]="Idle",t[t.Running=1]="Running",t[t.Paused=2]="Paused",t[t.Busy=3]="Busy",t}({}),St=function(t){return t[t.Running=0]="Running",t[t.Walking=1]="Walking",t}({}),yt=function t(e,n,i,a,r){_classCallCheck(this,t),this.timeISO=e,this.lon=n,this.lat=i,this.hr=a,this.cad=r},Tt=((M=function(){function t(e,n,a,c,u,d,p,f,m,v,R,P,x,M,Tt){var Ct=this;_classCallCheck(this,t),this.solosConnector=e,this.events=n,this.coachSettings=a,this.translate=c,this.platform=u,this.audioPlayer=d,this.backend=p,this.location=f,this.background=m,this.fileUtility=v,this.algo=R,this.postureSettings=P,this.heartRateDevice=x,this.stravaService=M,this.trainingSettings=Tt,this.state=Rt.Idle,this.walkingStateTimeout=null,this.runningStateTimeout=null,this.elapsedTimers=null,this.movingTimers=null,this.reminderTimer=null,this.training=!1,this.stravaInitedEventSubscribed=!1,this.initVars=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:St.Running,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ct.activityType=e,Ct.runningState=!1,Ct.walkingState=!1,Ct.walkingStateTimeout=null,Ct.runningStateTimeout=null,Ct.startTime=new Date,Ct.lastTimeStamp=Ct.startTime.getTime(),Ct.cumulatedTimeStamp=0,Ct.elapsedTimers=null,Ct.movingTimers=null,Ct.totalDistance=J,Ct.currCadence=X,Ct.maxCadence=X,Ct.minCadence=X,Ct.currPacing=j,Ct.minPacing=j,Ct.maxPacing=j,Ct.movingTimeAlwaysOn=!1,Ct.ignoreFirstMovingTimeUpdate=!1,Ct.movingTime=V,Ct.currStride=q,Ct.maxStride=q,Ct.minStride=q,Ct.lastStepCount=0,Ct.stepCount=Y,Ct.L_counter=Array(600).fill(1),Ct.R_counter=Array(600).fill(1),Ct.total_L_counter=Q,Ct.total_R_counter=z,Ct.M_time=$,Ct.L_ratio=tt,Ct.R_ratio=et,Ct.M_ratio=nt,Ct.useGPS=n,Ct.positionSubscription=null,Ct.calculatedGPSArray=[],Ct.gpxDataArray=[],Ct.resetAlgo(),Ct.sampleArray=[],Ct.gyroDataX=at,Ct.gyroDataY=rt,Ct.gyroDataZ=st,Ct.acceDataX=ct,Ct.acceDataY=ot,Ct.acceDataZ=ut,Ct.magnDataX=ht,Ct.magnDataY=lt,Ct.magnDataZ=gt,Ct.totalCalories=it,Ct.lastCaloriesCalculationDistance=0,Ct.lastCaloriesCalculationSteps=0,Ct.lastCaloriesCalculationTS=0,Ct.elevation=0,Ct.currHeartRate=0,Ct.lastHeartRate=0,Ct.lastHeartRateTS=0,Ct.heartRates=[],Ct.training=t,Ct.logGPSData=Ct.backend.getCoachLogEnabled(Ct.backend.getLoginUser()),Ct.localRecordFilename=Ct.getNowLocalRecordFilename(),Ct.uploadRecordsTimer=null;var i=Ct.startTime.getFullYear().toString()+("0"+(Ct.startTime.getMonth()+1)).slice(-2)+("0"+Ct.startTime.getDate()).slice(-2)+"-"+("0"+Ct.startTime.getHours()).slice(-2)+("0"+Ct.startTime.getMinutes()).slice(-2)+("0"+Ct.startTime.getSeconds()).slice(-2);Ct.originalGPSFileLog=new k(Ct.fileUtility,i+"-OriginalGPS.txt"),Ct.stepCountFileLog=new k(Ct.fileUtility,i+"-StepCount.txt"),Ct.gamFileLog=new k(Ct.fileUtility,i+"-GAM.txt"),Ct.LRreferenceFileLog=new k(Ct.fileUtility,i+"-LRreference.txt"),Ct.runningStateFileLog=new k(Ct.fileUtility,i+"-runningState.txt"),Ct.heartRateFileLog=new k(Ct.fileUtility,i+"-heartRate.txt")},this.resetAlgo=function(){Ct.algo.initMetrics(),Ct.lastGPSLoc=null},this.isTraining=function(){return Ct.training},this.speakStartActivity=function(){Ct.isTraining()?Ct.setState(Rt.Running):(Ct.background.enable(),Ct.audioPlayer.speech(!0,Ct.translate.instant("ai-coach.activity-started"),"",(function(){Ct.setState(Rt.Running)})))},this.speakStopActivity=function(){Ct.isTraining()?Ct.setState(Rt.Idle):(Ct.audioPlayer.flushPendingSpeech4tag(U),Ct.audioPlayer.speech(!0,Ct.translate.instant("ai-coach.activity-ended"),"",(function(){Ct.runCoachReminder(!0,(function(){Ct.background.disable(),Ct.setState(Rt.Idle)}))})))},this.speakResumeActivity=function(){Ct.isTraining()?Ct.setState(Rt.Running):(Ct.audioPlayer.flushPendingSpeech(),Ct.audioPlayer.speech(!0,Ct.translate.instant("ai-coach.activity-resumed"),"",(function(){Ct.setState(Rt.Running)})))},this.speakPauseActivity=function(){Ct.isTraining()?Ct.setState(Rt.Paused):(Ct.audioPlayer.flushPendingSpeech(),Ct.audioPlayer.speech(!0,Ct.translate.instant("ai-coach.activity-paused"),"",(function(){Ct.setState(Rt.Paused)})))},this.startSensors=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function n(){var i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t||this.useGPS&&(this.positionSubscription=this.location.startWatchPosition().subscribe((function(t){i.handleGPSUpdate(t)}))),this.events.subscribe(S.a,this.onHeartRateDeviceConnected),this.events.subscribe(S.b,this.onHeartRateDeviceDisconnected),this.events.subscribe(S.c,this.onHeartRateChanged),this.heartRateDevice.startHeartRateStreaming(),n.next=8,this.solosConnector.resetStepCount();case 8:if(this.events.subscribe(s.b,this.handleCoachIntervalChanged),this.events.subscribe(C.a,this.handleTrainingIntervalChanged),n.t0=t&&!e,n.t0){n.next=16;break}return this.events.subscribe(r.c,this.handleGAMBack),n.next=15,this.solosConnector.startGAM();case 15:e&&(this.ignoreFirstMovingTimeUpdate=!0);case 16:return n.next=18,this.solosConnector.startStepCount((function(t){i.handleStepCount(t)}));case 18:n.next=23;break;case 20:throw n.prev=20,n.t1=n.catch(0),n.t1;case 23:case"end":return n.stop()}}),n,this,[[0,20]])})))},this.stopSensors=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t||null!=this.positionSubscription&&(this.location.stopWatchPosition(this.positionSubscription),this.positionSubscription=null),this.events.unsubscribe(S.a,this.onHeartRateDeviceConnected),this.events.unsubscribe(S.b,this.onHeartRateDeviceDisconnected),this.events.unsubscribe(S.c,this.onHeartRateChanged),this.heartRateDevice.stopHeartRateStreaming(),this.events.unsubscribe(s.b,this.handleCoachIntervalChanged),this.events.unsubscribe(C.a,this.handleTrainingIntervalChanged),n.prev=2,n.next=5,this.solosConnector.stopStepCount();case 5:n.next=10;break;case 7:n.prev=7,n.t0=n.catch(2),console.log(n.t0);case 10:if(t&&!e){n.next=20;break}return this.events.unsubscribe(r.c,this.handleGAMBack),n.prev=12,n.next=15,this.solosConnector.stopGAM();case 15:n.next=20;break;case 17:n.prev=17,n.t1=n.catch(12),console.log(n.t1);case 20:return n.next=22,this.solosConnector.setTapSensitivity(this.solosConnector.getDefaultTapSensitivity());case 22:n.next=27;break;case 24:n.prev=24,n.t2=n.catch(0),console.log(n.t2);case 27:case"end":return n.stop()}}),n,this,[[0,24],[2,7],[12,17]])})))},this.start=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:St.Running,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ct.commandQueue.tryRun(new vt(mt.Start,{training:t,activityType:e,useGPS:n}))},this.startInternal=function(t){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.state==Rt.Idle){e.next=3;break}return e.abrupt("return");case 3:if(null!=this.solosConnector.getConnectedDevice()){e.next=5;break}return e.abrupt("return");case 5:return n=t.training,i=t.activityType,a=t.useGPS,this.setState(Rt.Busy),this.initVars(n,i,a),this.elapsedTimers=new o.a,this.movingTimers=new o.a,this.elapsedTimers.addTimer(this.publishOneSecondTimer,1e3),this.elapsedTimers.addTimer(this.calculateCalories,6e4),this.elapsedTimers.addTimer(this.saveLocalRecord,1e4),this.reminderTimer=this.isTraining()?this.movingTimers.addTimer(this.runExternalCoachReminderInTimer,60*this.trainingSettings.getReminderInterval()*1e3):this.elapsedTimers.addTimer(this.runCoachReminderInTimer,1e3*this.coachSettings.getReminderInterval()),e.next=16,this.startSensors();case 16:this.events.subscribe(r.g,this.handleSlidePause),this.stopUploadRecords(),this.speakStartActivity(),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(0),console.log(e.t0),e.next=26,this.stopSensors();case 26:this.setState(Rt.Idle);case 27:case"end":return e.stop()}}),e,this,[[0,21]])})))},this.stop=function(){Ct.commandQueue.tryRun(new vt(mt.Stop))},this.stopInternal=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.state==Rt.Running||this.state==Rt.Paused){t.next=3;break}return t.abrupt("return");case 3:return this.setState(Rt.Busy),t.next=6,this.stopSensors();case 6:return this.events.unsubscribe(r.g,this.handleSlidePause),t.next=9,this.saveLocalRecord();case 9:return this.uploadRecords(),this.speakStopActivity(),t.next=13,this.getActivityMetrics();case 13:e=t.sent,(n=new g.a).activityId=null,n.startTime=this.startTime,n.distance=e.distance,n.elapsedTime=e.elapsedTime,n.avgPacing=e.avgPace,n.maxPacing=e.maxPace,n.minPacing=e.minPace,n.movingTime=e.movingTime,n.stepCount=e.stepCount,n.calories=e.calories,n.avgStride=e.avgStride,n.maxStride=e.maxStride,n.minStride=e.minStride,n.avgCadence=e.avgCadence,n.maxCadence=e.maxCadence,n.minCadence=e.minCadence,n.leftBalance=e.avgLeftBalance,n.rightBalance=e.avgRightBalance,n.avgHeartRate=e.avgHeartRate,n.minHeartRate=e.minHeartRate,n.maxHeartRate=e.maxHeartRate,n.route=e.route,this.events.publish(I,{activity:n}),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.log(t.t0);case 21:case"end":return t.stop()}}),t,this,[[0,18]])})))},this.pause=function(){Ct.commandQueue.tryRun(new vt(mt.Pause))},this.pauseInternal=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.state==Rt.Running){e.next=3;break}return e.abrupt("return");case 3:return this.setState(Rt.Busy),this.stopRunningStateTimer(),this.stopRunningState(),this.stopWalkingStateTimer(),this.stopWalkingState(),this.calculatedGPSArray.length>0&&(this.calculatedGPSArray[this.calculatedGPSArray.length-1].paused=!0),this.resetAlgo(),e.next=12,this.stopSensors(!0,t);case 12:this.speakPauseActivity(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0),this.speakPauseActivity();case 18:case"end":return e.stop()}}),e,this,[[0,15]])})))},this.resume=function(){Ct.commandQueue.tryRun(new vt(mt.Resume))},this.resumeInternal=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.state==Rt.Paused){e.next=3;break}return e.abrupt("return");case 3:if(null!=this.solosConnector.getConnectedDevice()){e.next=5;break}return e.abrupt("return");case 5:return this.setState(Rt.Busy),e.next=8,this.startSensors(!0,t);case 8:this.speakResumeActivity(),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(0),console.log(e.t0),e.next=16,this.stopSensors();case 16:this.setState(Rt.Paused);case 17:case"end":return e.stop()}}),e,this,[[0,11]])})))},this.isRunning=function(){return Ct.state==Rt.Running||Ct.state==Rt.Paused||Ct.state==Rt.Busy},this.isPaused=function(){return Ct.state==Rt.Paused},this.isBusy=function(){return Ct.state==Rt.Busy},this.getRunTime=function(){return Ct.isRunning()?Ct.cumulatedTimeStamp:0},this.getCalculatedRoute=function(){return Ct.calculatedGPSArray},this.getPacing=function(){if(Ct.currPacing==j)return Ct.currPacing;if(Ct.currPacing==Ct.algo.PACING_LIMIT)return j;var t=Ct.currPacing;return Ct.coachSettings.getUnit()==s.d&&(t/=.62137),t},this.getStepCount=function(){return Ct.stepCount},this.getCadence=function(){return Ct.currCadence},this.getMovingTime=function(){return Ct.movingTime},this.setMovingTimeAlwaysOn=function(t){Ct.movingTimeAlwaysOn=t},this.getStride=function(){if(Ct.currStride==q)return Ct.currStride;var t=Ct.currStride;return Ct.coachSettings.getUnit()==s.d&&(t*=3.2808),t},this.getDistance=function(){var t=Ct.totalDistance;return Ct.coachSettings.getUnit()==s.d&&(t*=.62137),t},this.getLeftRatio=function(){return Ct.L_ratio},this.getRightRatio=function(){return Ct.R_ratio},this.getMiddleRatio=function(){return Ct.M_ratio},this.getCalories=function(){return Math.round(Ct.totalCalories)},this.onHeartRateDeviceConnected=function(t){Ct.currHeartRate=0,Ct.lastHeartRate=0,Ct.lastHeartRateTS=0,Ct.heartRateDevice.startHeartRateStreaming(),Ct.events.publish(_,{heartRate:Ct.currHeartRate})},this.onHeartRateDeviceDisconnected=function(t){Ct.currHeartRate=0,Ct.lastHeartRate=0,Ct.lastHeartRateTS=0,Ct.events.publish(_,{heartRate:Ct.currHeartRate})},this.onHeartRateChanged=function(t){Ct.currHeartRate=t.heartRate,Ct.currHeartRate>0&&Ct.heartRates.push(Ct.currHeartRate),Ct.saveHeartRate(Ct.cumulatedTimeStamp,Ct.currHeartRate),Ct.calculateHeartRateCalories(),Ct.events.publish(_,{heartRate:Ct.currHeartRate})},this.getHeartRate=function(){return Ct.currHeartRate},this.setState=function(t){t!=Ct.state&&(Ct.state=t,Ct.events.publish(D,{state:t}),Ct.state!=Rt.Busy&&Ct.commandQueue.runPendingCommands())},this.evtSolosDisconnected=function(t){Ct.commandQueue.tryRun(new vt(mt.PauseOnDisconnect))},this.evtSolosConnected=function(t){Ct.commandQueue.tryRun(new vt(mt.ResumeOnConnect))},this.handleSlidePause=function(){Ct.isPaused()?Ct.resume():Ct.pause()},this.isAutoPause=function(){return Ct.isTraining()?Ct.trainingSettings.getAutoPauseOn():Ct.coachSettings.getCoachAutoPauseOn()},this.handleGAMBack=function(t){var e=(new Date).getTime(),n=e-Ct.lastTimeStamp;if(Ct.lastTimeStamp=e,Ct.cumulatedTimeStamp+=n,Ct.elapsedTimers.update(n),Ct.state!=Rt.Paused){var i=!1;Ct.ignoreFirstMovingTimeUpdate?Ct.ignoreFirstMovingTimeUpdate=!1:Ct.isAutoPause()?Ct.runningState||Ct.walkingState?i=!0:Ct.movingTimeAlwaysOn&&(i=!0):i=!0,i&&(Ct.movingTime+=n,Ct.movingTimers.update(n))}if(Ct.state==Rt.Running){Ct.gyroDataX=t.gyroDataX,Ct.gyroDataY=t.gyroDataY,Ct.gyroDataZ=t.gyroDataZ,Ct.acceDataX=t.acceDataX,Ct.acceDataY=t.acceDataY,Ct.acceDataZ=t.acceDataZ,Ct.magnDataX=t.magnDataX,Ct.magnDataY=t.magnDataY,Ct.magnDataZ=t.magnDataZ,Ct.saveGAM(Ct.cumulatedTimeStamp,Ct.gyroDataX,Ct.gyroDataY,Ct.gyroDataZ,Ct.acceDataX,Ct.acceDataY,Ct.acceDataZ,Ct.magnDataX,Ct.magnDataY,Ct.magnDataZ,n);var a=Ct.solosConnector.getCalibratedGAM(Ct.acceDataX,Ct.acceDataY,Ct.acceDataZ,Ct.gyroDataX,Ct.gyroDataY,Ct.gyroDataZ,Ct.magnDataX,Ct.magnDataY,Ct.magnDataZ),r=a.Agx,s=a.Agy,c=a.Agz,o=a.Bax,u=a.Bay,h=a.Baz,l=Math.atan2(s,c),g=Math.atan(-r/(c*Math.cos(l)+s*Math.sin(l))),d=Math.atan2(h*Math.sin(l)-u*Math.cos(l),o*Math.cos(g)+u*Math.sin(g)*Math.sin(l)-h*Math.sin(g)*Math.cos(l)),p=Math.cos(d)*Math.cos(l)+Math.sin(l)*Math.sin(g)*Math.sin(d),f=Math.cos(d)*Math.sin(g)*Math.sin(l)-Math.cos(l)*Math.sin(d),m=-Math.cos(g)*Math.sin(l);if(Ct.elevation=180*Math.atan(m/Math.sqrt(Math.pow(p,2)+Math.pow(f,2)))/Math.PI,Ct.sampleArray.push(c),Ct.sampleArray.length>15){var v=Array.from(Ct.sampleArray);Ct.sampleArray.shift(),Ct.findWalkingState(v)&&Math.abs(Ct.elevation)<45&&(Ct.startWalkingStateTimer(),Ct.walkingState=!0),Ct.findRunningState(v)&&Math.abs(Ct.elevation)<45&&(Ct.startRunningStateTimer(),Ct.runningState=!0)}if(Ct.runningState||Ct.walkingState){var R,S=t.acceDataZ,y=t.acceDataX,T=Ct.postureSettings.getRollReference(),C=Math.atan(S/y);if(C*=180/Math.PI,null!=T){var b=C-T;R=C-T>ft?{LR:1,angle:b}:C-T<-ft?{LR:-1,angle:-b}:{LR:0,angle:b}}else R={LR:C>=0?1:-1,angle:C};1==R.LR?(Ct.L_counter.push(1),Ct.R_counter.push(0),Ct.L_counter.shift(),Ct.R_counter.shift(),Ct.total_L_counter+=1):-1==R.LR?(Ct.L_counter.push(0),Ct.R_counter.push(1),Ct.L_counter.shift(),Ct.R_counter.shift(),Ct.total_R_counter+=1):0==R.LR&&(Ct.L_counter.push(1),Ct.R_counter.push(1),Ct.L_counter.shift(),Ct.R_counter.shift(),Ct.total_L_counter+=.5,Ct.total_R_counter+=.5);var k=Ct.L_counter.filter((function(t){return t>0})),P=Ct.R_counter.filter((function(t){return t>0})),x=k.length,M=P.length;if(Ct.L_ratio=x/(x+M),Ct.R_ratio=M/(x+M),Ct.runningState){var D=Ct.solosConnector.getDefaultTapSensitivity()+12;D>Ct.solosConnector.getMaxTapSensitivity()&&(D=Ct.solosConnector.getMaxTapSensitivity()),Ct.solosConnector.setTapSensitivity(D)}}else Ct.L_ratio=tt,Ct.R_ratio=et,Ct.solosConnector.setTapSensitivity(Ct.solosConnector.getDefaultTapSensitivity());Ct.saveRunningState(Ct.cumulatedTimeStamp,Ct.walkingState,Ct.runningState),Ct.publishMetricDataChangedEvent()}else Ct.publishMetricDataChangedEvent()},this.startWalkingStateTimer=function(){Ct.stopWalkingStateTimer(),Ct.walkingStateTimeout=Ct.elapsedTimers.addTimer(Ct.stopWalkingState,dt,!0)},this.stopWalkingStateTimer=function(){null!=Ct.walkingStateTimeout&&(Ct.elapsedTimers.removeTimer(Ct.walkingStateTimeout),Ct.walkingStateTimeout=null)},this.startRunningStateTimer=function(){Ct.stopRunningStateTimer(),Ct.runningStateTimeout=Ct.elapsedTimers.addTimer(Ct.stopRunningState,dt,!0)},this.stopRunningStateTimer=function(){null!=Ct.runningStateTimeout&&(Ct.elapsedTimers.removeTimer(Ct.runningStateTimeout),Ct.runningStateTimeout=null)},this.stopWalkingState=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.walkingState=!1;case 1:case"end":return t.stop()}}),t,this)})))},this.stopRunningState=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.runningState=!1;case 1:case"end":return t.stop()}}),t,this)})))},this.handleStepCount=function(t){var e=t.stepCount-Ct.lastStepCount;e<0&&(e=t.stepCount),Ct.lastStepCount=t.stepCount,Ct.state==Rt.Running&&(Ct.stepCount==Y&&(Ct.stepCount=0),Ct.stepCount+=e,Ct.saveStepCount(Ct.cumulatedTimeStamp,Ct.stepCount),Ct.publishMetricDataChangedEvent())},this.handleGPSUpdate=function(t){if(Ct.state==Rt.Running){Ct.lastGPSLoc=new l.b(t.coords.latitude,t.coords.longitude),Ct.saveOriginalGPS(Ct.cumulatedTimeStamp,t.coords.latitude,t.coords.longitude);var e=Ct.algo.calculateMetrics(Ct.cumulatedTimeStamp,t.coords.latitude,t.coords.longitude,Ct.stepCount,Ct.gyroDataX,Ct.gyroDataY,Ct.gyroDataZ,Ct.acceDataX,Ct.acceDataY,Ct.acceDataZ,Ct.magnDataX,Ct.magnDataY,Ct.magnDataZ,Ct.walkingState?1:0,Ct.runningState?1:0);null!=e&&(Ct.totalDistance+=e.deltaD/1e3,Ct.currPacing=e.pacing,Ct.currCadence=Math.round(60*e.cadence),Ct.currStride=e.stride,Ct.walkingState||Ct.runningState?(Ct.currPacing!=Ct.algo.PACING_LIMIT&&(Ct.maxPacing!=j&&Ct.minPacing!=j||(Ct.maxPacing=Ct.currPacing,Ct.minPacing=Ct.currPacing),Ct.maxPacing=Math.max(Ct.currPacing,Ct.maxPacing),Ct.minPacing=Math.min(Ct.currPacing,Ct.minPacing)),0!=Ct.currCadence&&(Ct.maxCadence!=X&&Ct.minCadence!=X||(Ct.maxCadence=Ct.currCadence,Ct.minCadence=Ct.currCadence),Ct.maxCadence=Math.max(Ct.maxCadence,Ct.currCadence),Ct.minCadence=Math.min(Ct.minCadence,Ct.currCadence)),0!=Ct.currStride&&(Ct.maxStride!=q&&Ct.minStride!=q||(Ct.maxStride=Ct.currStride,Ct.minStride=Ct.currStride),Ct.maxStride=Math.max(Ct.maxStride,Ct.currStride),Ct.minStride=Math.min(Ct.minStride,Ct.currStride)),e.isValidPoint&&Ct.calculatedGPSArray.push(Ct.lastGPSLoc)):(Ct.currPacing=j,Ct.currCadence=X,Ct.currStride=q),(Ct.isTraining()&&Ct.trainingSettings.getUploadStrava()||!Ct.isTraining())&&Ct.gpxDataArray.push(new yt((new Date).toISOString(),t.coords.longitude,t.coords.latitude,Ct.currHeartRate,Ct.currCadence)),Ct.publishMetricDataChangedEvent(),Ct.publishRouteChangedEvent())}},this.calculateHeartRateCalories=function(){if(Ct.state==Rt.Running){if(0!=Ct.lastHeartRate&&0!=Ct.lastHeartRateTS){var t=void 0,e=0,n=0,i=Ct.backend.getLoginUser();null!=i&&(Ct.backend.getGender(i)!=h.b.Unknown&&(t=Ct.backend.getGender(i)==h.b.Male),e=Ct.backend.getWeight(i),n=Ct.backend.getAge(i)),Ct.totalCalories+=Ct.algo.getHeartRateCalories(t,e,n,Ct.cumulatedTimeStamp-Ct.lastHeartRateTS,Ct.lastHeartRate)}Ct.lastHeartRate=Ct.currHeartRate,Ct.lastHeartRateTS=Ct.cumulatedTimeStamp}else Ct.lastHeartRate=0,Ct.lastHeartRateTS=0},this.calculateCalories=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i,a,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state==Rt.Running&&null==this.heartRateDevice.getConnectedDeviceId()&&(e=void 0,n=0,i=0,a=0,null!=(r=this.backend.getLoginUser())&&(this.backend.getGender(r)!=h.b.Unknown&&(e=this.backend.getGender(r)==h.b.Male),n=this.backend.getWeight(r),i=this.backend.getHeight(r),a=this.backend.getAge(r)),this.totalCalories+=this.activityType==St.Running?this.algo.getRunningCalories(e,n,i,a,this.cumulatedTimeStamp-this.lastCaloriesCalculationTS,this.totalDistance-this.lastCaloriesCalculationDistance):this.algo.getStepsCalories(e,n,i,a,this.cumulatedTimeStamp-this.lastCaloriesCalculationTS,this.stepCount-this.lastCaloriesCalculationSteps)),this.lastCaloriesCalculationDistance=this.totalDistance,this.lastCaloriesCalculationSteps=this.stepCount,this.lastCaloriesCalculationTS=this.cumulatedTimeStamp;case 2:case"end":return t.stop()}}),t,this)})))},this.publishRouteChangedEvent=function(){Ct.events.publish(O,{calculatedRoute:Ct.calculatedGPSArray})},this.publishMetricDataChangedEvent=function(){Ct.events.publish(w)},this.publishOneSecondTimer=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.events.publish(A);case 1:case"end":return t.stop()}}),t,this)})))},this.handleCoachIntervalChanged=function(){null==Ct.reminderTimer||Ct.isTraining()||Ct.elapsedTimers.changeInterval(Ct.reminderTimer,1e3*Ct.coachSettings.getReminderInterval())},this.handleTrainingIntervalChanged=function(){null!=Ct.reminderTimer&&Ct.isTraining()&&Ct.movingTimers.changeInterval(Ct.reminderTimer,60*Ct.trainingSettings.getReminderInterval()*1e3)},this.runExternalCoachReminderInTimer=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state==Rt.Running&&this.events.publish(L);case 1:case"end":return t.stop()}}),t,this)})))},this.runCoachReminderInTimer=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state==Rt.Running&&this.runCoachReminder();case 1:case"end":return t.stop()}}),t,this)})))},this.runCoachReminder=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0,n=[];if(Ct.coachSettings.getReminderTypeElapsedTimeOn()){var i=Ct.getSpokenTextElapsedTime();null!=i&&n.push(i)}if(Ct.coachSettings.getReminderTypeDistanceOn()){var a=Ct.getSpokenTextDistance();null!=a&&n.push(a)}if(Ct.coachSettings.getReminderTypePacingOn()&&!t){var r=Ct.getSpokenTextPacing();null!=r&&n.push(r)}if(Ct.coachSettings.getReminderTypeAveragePacingOn()){var s=Ct.getSpokenTextAvgPacing();null!=s&&n.push(s)}if(Ct.coachSettings.getReminderTypeMovingTimeOn()){var c=Ct.getSpokenTextMovingTime();null!=c&&n.push(c)}if(Ct.coachSettings.getReminderTypeStepCountOn()){var o=Ct.getSpokenTextStepCount();null!=o&&n.push(o)}if(Ct.coachSettings.getReminderHeartRateTypeOn()&&!t){var u=Ct.getSpokenTextHeartRate();null!=u&&n.push(u)}if(Ct.coachSettings.getReminderTypeStrideOn()&&!t){var h=Ct.getSpokenTextStride();null!=h&&n.push(h)}if(Ct.coachSettings.getReminderTypeAverageStrideOn()){var l=Ct.getSpokenTextAvgStride();null!=l&&n.push(l)}if(Ct.coachSettings.getReminderTypeCadenceOn()&&!t){var g=Ct.getSpokenTextCadence();null!=g&&n.push(g)}if(Ct.coachSettings.getReminderTypeAverageCadenceOn()){var d=Ct.getSpokenTextAvgCadence();null!=d&&n.push(d)}if(Ct.coachSettings.getReminderTypeLeftBalanceOn()&&!t){var p=Ct.getSpokenTextLeftBalance();null!=p&&n.push(p)}if(Ct.coachSettings.getReminderTypeRightBalanceOn()&&!t){var f=Ct.getSpokenTextRightBalance();null!=f&&n.push(f)}if(Ct.coachSettings.getReminderTypeLeftBalanceOn()&&t){var m=Ct.getSpokenTextAvgLeftBalance();null!=m&&n.push(m)}if(Ct.coachSettings.getReminderTypeRightBalanceOn()&&t){var v=Ct.getSpokenTextAvgRightBalance();null!=v&&n.push(v)}if(n.length)for(var R=0;R<n.length;R++)t||0!=R?R==n.length-1?Ct.audioPlayer.speech(!1,n[R],U,e):Ct.audioPlayer.speech(!1,n[R],U):Ct.audioPlayer.speech(!0,n[R],U);else void 0!==e&&e()},this.getSpokenTextHeartRate=function(){return Ct.currHeartRate>0?Ct.translate.instant("ai-coach.heart-rate-is",{value:Ct.currHeartRate}):null},this.getSpokenTextPacing=function(){var t=Ct.currPacing;if(t<0)return null;Ct.coachSettings.getUnit()==s.d&&(t/=.62137);var e=Math.floor(t).toString(),n=Math.floor(t%1*60).toString();return Ct.coachSettings.getUnit()==s.d?Ct.translate.instant("ai-coach.pacing-is-full-mile",{min:e,sec:n}):Ct.translate.instant("ai-coach.pacing-is-full-km",{min:e,sec:n})},this.getSpokenTextAvgPacing=function(){var t=0!=Ct.totalDistance?Ct.movingTime/1e3/60/Ct.totalDistance:j;if(t<=0)return null;Ct.coachSettings.getUnit()==s.d&&(t/=.62137);var e=Math.floor(t).toString(),n=Math.floor(t%1*60).toString();return Ct.coachSettings.getUnit()==s.d?Ct.translate.instant("ai-coach.avg-pacing-is-full-mile",{min:e,sec:n}):Ct.translate.instant("ai-coach.avg-pacing-is-full-km",{min:e,sec:n})},this.getSpokenTextElapsedTime=function(){var t=Math.floor(Ct.cumulatedTimeStamp/1e3%60),e=Math.floor(Ct.cumulatedTimeStamp/1e3/60)%60,n=Math.floor(Ct.cumulatedTimeStamp/1e3/3600),i=null;return n<1?e<1?t>0&&(i=Ct.translate.instant("ai-coach.elapsed-time-is")+" "+t+Ct.translate.instant("ai-coach.seconds")):i=t>0?Ct.translate.instant("ai-coach.elapsed-time-is")+" "+e+" "+Ct.translate.instant("ai-coach.minutes-and")+" "+t+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.elapsed-time-is")+" "+e+" "+Ct.translate.instant("ai-coach.minutes"):i=e<1?t>0?Ct.translate.instant("ai-coach.elapsed-time-is")+" "+n+" "+Ct.translate.instant("ai-coach.hours-and")+" "+t+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.elapsed-time-is")+" "+n+" "+Ct.translate.instant("ai-coach.hours"):t>0?Ct.translate.instant("ai-coach.elapsed-time-is")+" "+n+" "+Ct.translate.instant("ai-coach.hours")+e+" "+Ct.translate.instant("ai-coach.minutes-and")+" "+t+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.elapsed-time-is")+" "+n+" "+Ct.translate.instant("ai-coach.hours")+e+" "+Ct.translate.instant("ai-coach.minutes"),i},this.getSpokenTextDistance=function(){var t=Ct.totalDistance;return Ct.coachSettings.getUnit()==s.d&&(t*=.62137),Ct.translate.instant("ai-coach.distance-is")+" "+t.toFixed(2)+Ct.translate.instant(Ct.coachSettings.getUnit()==s.d?"ai-coach.miles":"ai-coach.k-m")},this.getSpokenTextMovingTime=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Math.floor(Ct.movingTime/1e3),n=Math.floor(e%60),i=Math.floor(e/60%60),a=Math.floor(e/3600),r=null;return a<1?i<1?n>0?r=Ct.translate.instant("ai-coach.moving-time-is")+" "+n+Ct.translate.instant("ai-coach.seconds"):t&&(r=Ct.translate.instant("ai-coach.moving-time-is")+" "+n+Ct.translate.instant("ai-coach.seconds")):r=n>0?Ct.translate.instant("ai-coach.moving-time-is")+" "+i+" "+Ct.translate.instant("ai-coach.minutes-and")+" "+n+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.moving-time-is")+" "+i+" "+Ct.translate.instant("ai-coach.minutes"):r=i<1?n>0?Ct.translate.instant("ai-coach.moving-time-is")+" "+a+" "+Ct.translate.instant("ai-coach.hours-and")+" "+n+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.moving-time-is")+" "+a+" "+Ct.translate.instant("ai-coach.hours"):n>0?Ct.translate.instant("ai-coach.moving-time-is")+" "+a+" "+Ct.translate.instant("ai-coach.hours")+i+" "+Ct.translate.instant("ai-coach.minutes-and")+" "+n+" "+Ct.translate.instant("ai-coach.seconds"):Ct.translate.instant("ai-coach.moving-time-is")+" "+a+" "+Ct.translate.instant("ai-coach.hours")+i+" "+Ct.translate.instant("ai-coach.minutes"),r},this.getSpokenTextStepCount=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Ct.stepCount;if(e<0){if(!t)return null;e=0}return Ct.translate.instant("ai-coach.step-count-is")+" "+e},this.getSpokenTextStride=function(){var t=Ct.currStride;return t<0?null:(Ct.coachSettings.getUnit()==s.d&&(t*=3.2808),Ct.translate.instant("ai-coach.stride-is")+" "+t.toFixed(2)+Ct.translate.instant(Ct.coachSettings.getUnit()==s.d?"ai-coach.feet":"ai-coach.meter"))},this.getSpokenTextAvgStride=function(){var t=0!=Ct.stepCount?1e3*Ct.totalDistance/Ct.stepCount:q;return t<=0?null:(Ct.coachSettings.getUnit()==s.d&&(t*=3.2808),Ct.translate.instant("ai-coach.avg-stride-is")+" "+t.toFixed(2)+Ct.translate.instant(Ct.coachSettings.getUnit()==s.d?"ai-coach.feet":"ai-coach.meter"))},this.getSpokenTextCadence=function(){var t=Ct.currCadence;return t<=0?null:Ct.translate.instant("ai-coach.cadence-is-full",{value:t.toFixed(0)})},this.getSpokenTextAvgCadence=function(){var t=0!=Ct.movingTime?Ct.stepCount/(Ct.movingTime/1e3/60):X;return t<=0?null:Ct.translate.instant("ai-coach.avg-cadence-is-full",{value:t.toFixed(0)})},this.getSpokenTextLeftBalance=function(){var t=Math.round(100*Ct.L_ratio);return t<0?null:Ct.translate.instant("ai-coach.curr-left-bal-is",{value:t})},this.getSpokenTextRightBalance=function(){var t=Math.round(100*Ct.R_ratio);return t<0?null:Ct.translate.instant("ai-coach.curr-right-bal-is",{value:t})},this.getSpokenTextAvgLeftBalance=function(){var t=tt;0==Ct.total_L_counter&&0==Ct.total_R_counter||(t=Ct.total_L_counter/(Ct.total_L_counter+Ct.total_R_counter));var e=Math.round(100*t);return e<0?null:Ct.translate.instant("ai-coach.avg-left-bal-is",{value:e})},this.getSpokenTextAvgRightBalance=function(){var t=tt;0==Ct.total_L_counter&&0==Ct.total_R_counter||(t=Ct.total_R_counter/(Ct.total_L_counter+Ct.total_R_counter));var e=Math.round(100*t);return e<0?null:Ct.translate.instant("ai-coach.avg-right-bal-is",{value:e})},this.getActivityMetrics=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i,a,r,s,c,o,u,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=[],this.calculatedGPSArray.length&&(e=Array.from(this.calculatedGPSArray)),!(e.length<2)){t.next=11;break}if(null==this.lastGPSLoc){t.next=7;break}e.push(this.lastGPSLoc),t.next=11;break;case 7:return t.next=9,this.location.getCurrentPosition();case 9:n=t.sent,e.push(void 0!==n?new l.b(n.coords.latitude,n.coords.longitude):new l.b(22.42427,114.21419));case 11:return(i=0!=this.totalDistance?this.movingTime/1e3/60/this.totalDistance:j)>=this.algo.PACING_LIMIT&&(i=this.algo.PACING_LIMIT),(a=0!=this.stepCount?1e3*this.totalDistance/this.stepCount:q)>=pt&&(a=pt),r=0,s=0,c=0,this.heartRates.length>0&&(r=Math.round(this.heartRates.reduce((function(t,e){return t+e}),0)/this.heartRates.length),c=Math.max.apply(Math,this.heartRates),s=Math.min.apply(Math,this.heartRates)),o=tt,u=et,0==this.total_L_counter&&0==this.total_R_counter||(o=this.total_L_counter/(this.total_L_counter+this.total_R_counter),u=this.total_R_counter/(this.total_L_counter+this.total_R_counter)),h=this.getCalories(),t.abrupt("return",{elapsedTime:this.cumulatedTimeStamp/1e3,distance:this.totalDistance,stepCount:this.stepCount,avgPace:i,minPace:this.minPacing,maxPace:this.maxPacing,movingTime:this.movingTime/1e3,avgStride:a,minStride:this.minStride,maxStride:this.maxStride,avgCadence:0!=this.movingTime?Math.round(this.stepCount/(this.movingTime/1e3/60)):X,minCadence:this.minCadence,maxCadence:this.maxCadence,avgLeftBalance:o,avgRightBalance:u,calories:h,avgHeartRate:r,minHeartRate:s,maxHeartRate:c,route:e});case 23:t.prev=23,t.t0=t.catch(0),console.log(t.t0);case 26:case"end":return t.stop()}}),t,this,[[0,23]])})))},this.getNowLocalRecordFilename=function(){var t=Object(T.c)(new Date);return B+t},this.uploadPendingRecords=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.stravaService.inited()){t.next=9;break}if(this.stravaInitedEventSubscribed&&(this.stravaInitedEventSubscribed=!1,this.events.unsubscribe(y.a,this.uploadPendingRecords)),t.t0=this.isRunning(),t.t0){t.next=7;break}return t.next=7,this.uploadRecords();case 7:t.next=10;break;case 9:this.stravaInitedEventSubscribed||(this.stravaInitedEventSubscribed=!0,this.events.subscribe(y.a,this.uploadPendingRecords));case 10:t.next=15;break;case 12:t.prev=12,t.t1=t.catch(0),console.log(t.t1.message);case 15:case"end":return t.stop()}}),t,this,[[0,12]])})))},this.stopUploadRecords=function(){null!=Ct.uploadRecordsTimer&&(clearTimeout(Ct.uploadRecordsTimer),Ct.uploadRecordsTimer=null)},this.uploadRecords=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i,a,r,s,c,o,u,h=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.background.enable(),t.next=4,this.fileUtility.listFiles(H);case 4:e=t.sent,n=_createForOfIteratorHelper(e),t.prev=6,n.s();case 8:if((i=n.n()).done){t.next=14;break}return a=i.value,t.next=12,this.uploadAiRecord(a);case 12:t.next=8;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),n.e(t.t0);case 19:return t.prev=19,n.f(),t.finish(19);case 22:return t.next=24,this.fileUtility.listFiles(F);case 24:e=t.sent,r=_createForOfIteratorHelper(e),t.prev=26,r.s();case 28:if((s=r.n()).done){t.next=34;break}return c=s.value,t.next=32,this.uploadStravaRecord(c);case 32:t.next=28;break;case 34:t.next=39;break;case 36:t.prev=36,t.t1=t.catch(26),r.e(t.t1);case 39:return t.prev=39,r.f(),t.finish(39);case 42:return t.next=44,this.fileUtility.listFiles(H);case 44:return o=t.sent,t.next=47,this.fileUtility.listFiles(F);case 47:u=t.sent,(o.length||u.length)&&null==this.uploadRecordsTimer&&(this.uploadRecordsTimer=setTimeout((function(){h.uploadRecordsTimer=null,h.uploadRecords()}),G)),t.next=54;break;case 51:t.prev=51,t.t2=t.catch(0),console.log(t.t2);case 54:return t.prev=54,this.background.disable(),t.finish(54);case 57:case"end":return t.stop()}}),t,this,[[0,51,54,57],[6,16,19,22],[26,36,39,42]])})))},this.uploadAiRecord=function(t){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fileUtility.checkFile(t);case 3:return e.next=5,this.fileUtility.readJSONFile(t);case 5:if(null==(n=e.sent)){e.next=12;break}if(i=new Date(n.startTime),a=n.metrics,e.t0=0!==Object.keys(a).length,!e.t0){e.next=12;break}return e.next=12,this.backend.saveActivity(i,a.elapsedTime,a.distance,a.stepCount,a.avgPace,a.minPace,a.maxPace,a.movingTime,a.avgStride,a.minStride,a.maxStride,a.avgCadence,a.minCadence,a.maxCadence,a.avgLeftBalance,a.avgRightBalance,a.calories,a.avgHeartRate,a.minHeartRate,a.maxHeartRate,a.route);case 12:return e.next=14,this.fileUtility.deleteFile(t);case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(0),console.log(e.t1.message);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})))},this.uploadStravaRecord=function(t){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fileUtility.checkFile(t);case 3:return e.next=5,this.fileUtility.readJSONFile(t);case 5:if(null==(n=e.sent)){e.next=12;break}if(i=new Date(n.startTime),!n.gpxDataArray.length){e.next=12;break}return a=Number(n.avgPace),e.next=12,this.stravaService.uploadActivity(i,a,n.gpxDataArray);case 12:return e.next=14,this.fileUtility.deleteFile(t);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0.message);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})))},this.saveLocalRecord=function(){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i,a,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=this.startTime,t.next=4,this.getActivityMetrics();case 4:return n=t.sent,i=n.avgPace,a={startTime:e.toISOString(),metrics:n},t.next=9,this.fileUtility.saveTextFile(this.localRecordFilename+H,JSON.stringify(a));case 9:return r={startTime:e.toISOString(),gpxDataArray:this.gpxDataArray,avgPace:i},t.next=12,this.fileUtility.saveTextFile(this.localRecordFilename+F,JSON.stringify(r));case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),console.log(t.t0.message);case 17:case"end":return t.stop()}}),t,this,[[0,14]])})))},this.saveOriginalGPS=function(t,e,n){if(Ct.logGPSData){var i=Ct.walkingState?1:0,a=Ct.runningState?1:0,r=String(t)+","+String(e)+","+String(n)+","+Ct.stepCount+","+Ct.gyroDataX+","+Ct.gyroDataY+","+Ct.gyroDataZ+","+Ct.acceDataX+","+Ct.acceDataY+","+Ct.acceDataZ+","+Ct.magnDataX+","+Ct.magnDataY+","+Ct.magnDataZ+","+i+","+a+","+Ct.currHeartRate;Ct.originalGPSFileLog.append(r)}},this.saveStepCount=function(t,e){if(W){var n=String(t)+","+String(e);Ct.stepCountFileLog.append(n)}},this.saveGAM=function(t,e,n,i,a,r,s,c,o,u,h){if(E){var l=String(t)+","+String(a)+","+String(r)+","+String(s)+","+String(e)+","+String(n)+","+String(i)+","+String(c)+","+String(o)+","+String(u)+","+String(h);Ct.gamFileLog.append(l)}},this.saveLRReferece=function(t,e,n,i){if(N){var a=String(t)+","+String(e)+","+String(n)+","+String(i);Ct.LRreferenceFileLog.append(a)}},this.saveRunningState=function(t,e,n){if(Z){var i=String(t)+","+(e?1:0)+","+(n?1:0);Ct.runningStateFileLog.append(i)}},this.saveHeartRate=function(t,e){if(K){var n=String(t)+","+e;Ct.heartRateFileLog.append(n)}},this.runCommand=function(t){return i.b(Ct,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!0,!this.isBusy()){e.next=5;break}n=!1,e.next=21;break;case 5:if(!(t instanceof vt)){e.next=21;break}i=t,e.t0=i.type,e.next=e.t0===mt.Start?10:e.t0===mt.Pause?12:e.t0===mt.PauseOnDisconnect?14:e.t0===mt.Resume?16:e.t0===mt.ResumeOnConnect?18:e.t0===mt.Stop?20:21;break;case 10:return this.startInternal(i.para),e.abrupt("break",21);case 12:return this.pauseInternal(),e.abrupt("break",21);case 14:return this.pauseInternal(!0),e.abrupt("break",21);case 16:return this.resumeInternal(),e.abrupt("break",21);case 18:return this.resumeInternal(!0),e.abrupt("break",21);case 20:this.stopInternal();case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this)})))},this.platform.ready().then((function(){Ct.commandQueue=new b.a(Ct.runCommand),Ct.events.subscribe(r.k,Ct.evtSolosDisconnected),Ct.events.subscribe(r.j,Ct.evtSolosConnected),Ct.initVars(),Ct.uploadPendingRecords()}))}return _createClass(t,[{key:"findWalkingState",value:function(t){var e=Object(c.fft)(t),n=c.util.fftFreq(e,10),i=c.util.fftMag(e);return n.map((function(t,e){return{freq:t,sp:i[e]}})).filter((function(t,e){return t.freq>.12&&t.sp>6})).reduce((function(t,e){return t+Math.abs(e.sp)}),0)>10}},{key:"findRunningState",value:function(t){var e=Object(c.fft)(t),n=c.util.fftFreq(e,10),i=c.util.fftMag(e);return n.map((function(t,e){return{freq:t,sp:i[e]}})).filter((function(t,e){return t.freq>.2&&t.sp>45})).reduce((function(t,e){return t+Math.abs(e.sp)}),0)>10}}]),t}()).ngInjectableDef=P.ac({factory:function(){return new M(P.bc(r.l),P.bc(a.f),P.bc(s.a),P.bc(x.k),P.bc(a.Mb),P.bc(u.f),P.bc(h.c),P.bc(d.a),P.bc(p.a),P.bc(f.a),P.bc(m.a),P.bc(v.d),P.bc(R.a),P.bc(y.c),P.bc(C.e))},token:M,providedIn:"root"}),M)},DaA9:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return h})),n.d(e,"e",(function(){return l})),n.d(e,"d",(function(){return g}));var i=n("mrSG"),a=n("ZZ/e"),r=n("Zesz"),s=n("8Y7J"),c=n("xgBC"),o="evtPostureViewEnter",u="evtPostureAlertStateChange",h="evtPostureRemindIntervalChange",l=function(t){return t[t.Normal=0]="Normal",t[t.Slight=1]="Slight",t[t.Serious=2]="Serious",t[t.Severe=3]="Severe",t}({}),g=function(){var t=function t(e,n,a){var r=this;_classCallCheck(this,t),this.storage=e,this.platform=n,this.us=a,this.alertLevelNum=l.Serious,this.rollReference=null,this.pitchReference=null,this.firstCalRoll=null,this.firstCalPitch=null,this.reminderMethod="voice",this.recordLimit=60,this.remindInterval=10,this.firstCalLRBalance=null,this.LRBalanceReference=null,this.firstCalExePitch=null,this.exePitchReference=null,this.setRollReference=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.rollReference){e.next=10;break}return this.rollReference=t,e.prev=2,e.next=5,this.storage.set("Calibration-rollValue",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.eraseRollReference=function(){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.rollReference=null,t.next=4,this.storage.remove("Calibration-rollValue");case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))},this.setPitchReference=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.pitchReference){e.next=10;break}return this.pitchReference=t,e.prev=2,e.next=5,this.storage.set("Calibration-pitchValue",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.erasePitchReference=function(){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.pitchReference=null,t.next=4,this.storage.remove("Calibration-pitchValue");case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))},this.setLRBalanceReference=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.LRBalanceReference){e.next=10;break}return this.LRBalanceReference=t,e.prev=2,e.next=5,this.storage.set("Calibration-LRBalance",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.setExePitchReference=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.exePitchReference){e.next=10;break}return this.exePitchReference=t,e.prev=2,e.next=5,this.storage.set("Calibration-exe-pitchValue",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.setAlertLevelNum=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.alertLevelNum){e.next=10;break}return this.alertLevelNum=t,e.prev=2,e.next=5,this.storage.set("PostureReminder-alertLevelNum",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.setReminderMethod=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.reminderMethod){e.next=10;break}return this.reminderMethod=t,e.prev=2,e.next=5,this.storage.set("PostureReminder-reminderMethod",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.setRemindInterval=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.remindInterval){e.next=10;break}return this.remindInterval=t,e.prev=2,e.next=5,this.storage.set("PostureReminder-reminderInterval",t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.setFirstCalRoll=function(t){r.firstCalRoll=t},this.setFirstCalPitch=function(t){r.firstCalPitch=t},this.setFirstCalExePitch=function(t){r.firstCalExePitch=t},this.setFirstCalLRBalance=function(t){r.firstCalLRBalance=t},this.setRecordLimit=function(t){r.recordLimit=t},this.getRollReference=function(){return r.rollReference},this.getPitchReference=function(){return r.pitchReference},this.isRollPitchReferencesCalibrated=function(){var t=r.getRollReference(),e=r.getPitchReference();return null!=t&&null!=e},this.getExePitchReference=function(){return r.exePitchReference},this.getLRBalanceReference=function(){return r.LRBalanceReference},this.getAlertLevelNum=function(){return r.alertLevelNum},this.getReminderMethod=function(){return r.reminderMethod},this.getRemindInterval=function(){return r.remindInterval},this.getFirstCalRoll=function(){return r.firstCalRoll},this.getFirstCalPitch=function(){return r.firstCalPitch},this.getFirstCalExePitch=function(){return r.firstCalExePitch},this.getFirstCalLRBalance=function(){return r.firstCalLRBalance},this.getRecordLimit=function(){return r.recordLimit},this.platform.ready().then((function(){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.platform.is("desktop")&&(this.rollReference=0,this.pitchReference=0,this.LRBalanceReference=0),e=null,t.next=5,this.storage.get("Calibration-rollValue");case 5:if(t.t0=e=t.sent,t.t1=null!=t.t0,!t.t1){t.next=9;break}this.rollReference=e;case 9:return t.next=11,this.storage.get("Calibration-pitchValue");case 11:if(t.t2=e=t.sent,t.t3=null!=t.t2,!t.t3){t.next=15;break}this.pitchReference=e;case 15:return t.next=17,this.storage.get("Calibration-exe-pitchValue");case 17:if(t.t4=e=t.sent,t.t5=null!=t.t4,!t.t5){t.next=21;break}this.exePitchReference=e;case 21:return t.next=23,this.storage.get("Calibration-LRBalance");case 23:if(t.t6=e=t.sent,t.t7=null!=t.t6,!t.t7){t.next=27;break}this.LRBalanceReference=e;case 27:return t.next=29,this.storage.get("PostureReminder-alertLevelNum");case 29:if(t.t8=e=t.sent,t.t9=null!=t.t8,!t.t9){t.next=33;break}this.alertLevelNum=e;case 33:return t.next=35,this.storage.get("PostureReminder-reminderMethod");case 35:if(t.t10=e=t.sent,t.t11=null!=t.t10,!t.t11){t.next=39;break}this.reminderMethod=e;case 39:return t.next=41,this.storage.get("PostureReminder-reminderInterval");case 41:if(t.t12=e=t.sent,t.t13=null!=t.t12,!t.t13){t.next=45;break}this.remindInterval=e;case 45:t.next=50;break;case 47:t.prev=47,t.t14=t.catch(0),console.log(JSON.stringify(t.t14));case 50:case"end":return t.stop()}}),t,this,[[0,47]])})))}))};return t.ngInjectableDef=s.ac({factory:function(){return new t(s.bc(c.b),s.bc(a.Mb),s.bc(r.a))},token:t,providedIn:"root"}),t}()},J5fJ:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}));var i=n("lGdP"),a=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a){var r;return _classCallCheck(this,n),(r=e.call(this,t,!0,!1,!0)).running=!1,r.accuStepCount=i,r.targetStepCount=a,r.useGPS=!1,r}return n}(i.k),r=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a,r,s,c,o,u,h){var l;return _classCallCheck(this,n),(l=e.call(this,i,a,r,s,c,o,u,h)).cfg=t,l.ttsTrainingStarted=l.translate.instant("ai-coach.activity-started"),l.ttsTrainingResumed=l.translate.instant("ai-coach.activity-resumed"),l.ttsTrainingPaused=l.translate.instant("ai-coach.activity-paused"),l.ttsTrainingEnded=l.translate.instant("ai-coach.activity-ended"),l}return _createClass(n,[{key:"coachMetricDataChanged",value:function(){_get(_getPrototypeOf(n.prototype),"coachMetricDataChanged",this).call(this),this.events.publish(i.a,this.getCoachMetricData())}},{key:"getCoachMetricData",value:function(){return{targetStepCount:this.cfg.targetStepCount,accuStepCount:this.cfg.accuStepCount,movingTime:this.movingTime,stepCount:this.stepCount}}},{key:"stopped",value:function(){var t=this,e=this.getSpokenTextWithMovingTime();this.audioPlayer.speech(!1,e),e=this.getSpokenTextStepCount(),this.audioPlayer.speech(!1,e);var i=this.stepCount;i<0&&(i=0),e=this.translate.instant("training.daily-goal-achieved",{value:(100*(this.cfg.accuStepCount+i)/this.cfg.targetStepCount).toFixed(0)}),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}}]),n}(i.j)},LRfq:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return c}));var i=n("lGdP"),a=n("8qa8"),r=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a,r,s,c,o){var u;return _classCallCheck(this,n),(u=e.call(this,t,!0,!0,!1)).running=!1,u.warmUpTime=i,u.warmUpCadence=a,u.fastWalkTime=r,u.fastWalkCadence=s,u.coolDownTime=c,u.coolDownCadence=o,u}return n}(i.k),s=function(t){return t.Idle="FAST_WALKING.Idle",t.WarmUp="FAST_WALKING.WarmUp",t.FastWalk="FAST_WALKING.FastWalk",t.CoolDown="FAST_WALKING.CoolDown",t.Stop="FAST_WALKING.Stop",t}({}),c=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a,r,c,o,u,h,l){var g;return _classCallCheck(this,n),(g=e.call(this,i,a,r,c,o,u,h,l)).getCurrentCadence=function(){return g.movingTime<1e3*g.cfg.warmUpTime?g.cfg.warmUpCadence:g.movingTime<1e3*(g.cfg.warmUpTime+g.cfg.fastWalkTime)?g.cfg.fastWalkCadence:g.cfg.coolDownCadence},g.cfg=t,g.fastWalkState=s.Idle,g.fastWalkInitStepCount=0,g.fastWalkInitMovingTime=0,g.fastWalkAvgCadence=0,g.fastWalkCadenceArray=[],g}return _createClass(n,[{key:"started",value:function(){var t=this;if(this.fastWalkState==s.Idle){this.fastWalkState=s.WarmUp;var e=this.translate.instant("fat-burn.say-warm-up");this.audioPlayer.speech(!1,e,"",(function(){var e=t.trainingSettings.getBeepVolume();t.audioPlayer.setVolume(a.e,e),t.audioPlayer.playMusic(!1,a.e,"",t.getCurrentCadence()),_get(_getPrototypeOf(n.prototype),"started",t).call(t)}))}else this.audioPlayer.playMusic(!1,a.e,"",this.getCurrentCadence()),_get(_getPrototypeOf(n.prototype),"started",this).call(this)}},{key:"coachPaused",value:function(){this.audioPlayer.stopMusic(a.e),_get(_getPrototypeOf(n.prototype),"coachPaused",this).call(this)}},{key:"coachStopped",value:function(){this.audioPlayer.stopMusic(a.e),_get(_getPrototypeOf(n.prototype),"coachStopped",this).call(this)}},{key:"stopped",value:function(){var t=this,e=this.getSpokenTextWithMovingTime();this.audioPlayer.speech(!1,e),e=this.getSpokenTextTotalDistance(),this.audioPlayer.speech(!1,e),e=this.getSpokenTextStepCount(),this.audioPlayer.speech(!1,e),this.calories>0&&(e=this.translate.instant("ai-coach.calories-is",{value:this.calories}),this.audioPlayer.speech(!1,e)),e=this.translate.instant("fat-burn.say-avg-spm-fast-walk",{value:this.fastWalkAvgCadence}),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}},{key:"beforeRunCoachReminder",value:function(){this.platform.is("ios")&&this.audioPlayer.stopMusic(a.e)}},{key:"afterRunCoachReminder",value:function(){this.platform.is("ios")&&this.audioPlayer.playMusic(!1,a.e,"",this.getCurrentCadence())}},{key:"coachMetricDataChanged",value:function(){var t=this;if(_get(_getPrototypeOf(n.prototype),"coachMetricDataChanged",this).call(this),this.movingTime>=1e3*(this.cfg.warmUpTime+this.cfg.fastWalkTime)){if(this.fastWalkState!=s.CoolDown){this.fastWalkState=s.CoolDown,this.audioPlayer.stopMusic(a.e);var e=this.translate.instant("fat-burn.say-cool-down");this.audioPlayer.speech(!0,e,"",(function(){t.audioPlayer.playMusic(!1,a.e,"",t.getCurrentCadence())}))}}else if(this.movingTime>=1e3*this.cfg.warmUpTime){if(this.fastWalkState!=s.FastWalk){this.fastWalkState=s.FastWalk,this.audioPlayer.stopMusic(a.e);var r=this.translate.instant("fat-burn.say-fast-walk");this.audioPlayer.speech(!0,r,"",(function(){t.audioPlayer.playMusic(!1,a.e,"",t.getCurrentCadence()),t.fastWalkInitStepCount=t.stepCount,t.fastWalkInitMovingTime=t.movingTime}))}if(0!=this.fastWalkInitMovingTime){var c=this.movingTime-this.fastWalkInitMovingTime,o=this.stepCount-this.fastWalkInitStepCount;this.fastWalkAvgCadence=0!=c&&o>=0?Math.round(o/(c/1e3/60)):0,this.coachActivity.getCadence()>0&&this.fastWalkCadenceArray.push(this.coachActivity.getCadence())}}this.events.publish(i.a,this.getCoachMetricData())}},{key:"getCoachMetricData",value:function(){return{fastWalkCadence:this.cfg.fastWalkCadence,movingTime:this.movingTime,distance:this.distance,stepCount:this.stepCount,calories:this.calories,currentCadence:this.currentCadence,fastWalkAvgCadence:this.fastWalkAvgCadence,fastWalkCadenceArray:this.fastWalkCadenceArray}}}]),n}(i.j)},N3Z2:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return s}));var i=n("lGdP"),a=n("8qa8"),r=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i){var a;return _classCallCheck(this,n),(a=e.call(this,t,!0,!0,!1)).targetCadence=i,a}return n}(i.k),s=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,r,s,c,o,u,h,l){var g,d;return _classCallCheck(this,n),(d=e.call(this,i,r,s,c,o,u,h,l)).cadenceCnt=[],d.coachPaused=function(){d.audioPlayer.stopMusic(a.e),_get((g=_assertThisInitialized(d),_getPrototypeOf(n.prototype)),"coachPaused",g).call(g)},d.cfg=t,d.avgCadence=0,d}return _createClass(n,[{key:"started",value:function(){var t=this.trainingSettings.getBeepVolume();this.audioPlayer.setVolume(a.e,t),this.audioPlayer.playMusic(!1,a.e,"",this.cfg.targetCadence),_get(_getPrototypeOf(n.prototype),"started",this).call(this)}},{key:"coachStopped",value:function(){this.audioPlayer.stopMusic(a.e),_get(_getPrototypeOf(n.prototype),"coachStopped",this).call(this)}},{key:"stopped",value:function(){var t=this,e=this.getSpokenTextWithMovingTime();this.audioPlayer.speech(!1,e),e=this.getSpokenTextTotalDistance(),this.audioPlayer.speech(!1,e),e=this.translate.instant("training.average-cadence",{x:this.avgCadence.toFixed(0)}),this.audioPlayer.speech(!1,e),e=this.translate.instant("training.achievement-is",{y:(100*this.avgCadence/this.cfg.targetCadence).toFixed(0)}),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}},{key:"beforeRunCoachReminder",value:function(){this.platform.is("ios")&&this.audioPlayer.stopMusic(a.e)}},{key:"afterRunCoachReminder",value:function(){this.platform.is("ios")&&this.audioPlayer.playMusic(!1,a.e,"",this.cfg.targetCadence)}},{key:"coachMetricDataChanged",value:function(){_get(_getPrototypeOf(n.prototype),"coachMetricDataChanged",this).call(this),this.avgCadence=0!=this.movingTime&&this.stepCount>=0?Math.round(this.stepCount/(this.movingTime/1e3/60)):0,this.currentCadence>0&&this.cadenceCnt.push(this.coachActivity.getCadence()),this.events.publish(i.a,this.getCoachMetricData())}},{key:"getCoachMetricData",value:function(){return{targetCadence:this.cfg.targetCadence,movingTime:this.movingTime,distance:this.distance,currentCadence:this.currentCadence,avgCadence:this.avgCadence,cadenceCnt:this.cadenceCnt}}}]),n}(i.j)},VjBM:function(t,e,n){"use strict";n.d(e,"b",(function(){return R})),n.d(e,"a",(function(){return S}));var i=n("ZZ/e"),a=n("BHc3"),r=n("R3bG"),s=n("lGdP"),c=n("6mIw"),o=n("N3Z2"),u=n("xVX2"),h=n("8qa8"),l=n("AGLQ"),g=n("J5fJ"),d=n("lIDq"),p=n("LRfq"),f=n("3Cwc"),m=n("8Y7J"),v=n("TSSN"),R=function(t){return t[t.Posture=0]="Posture",t[t.Cadence=1]="Cadence",t[t.Interval=2]="Interval",t[t.StepCount=3]="StepCount",t[t.FastWalk=4]="FastWalk",t}({}),S=function(){var t=function t(e,n,i,r,h,l,d,f,m){var v=this;_classCallCheck(this,t),this.solosConnector=e,this.coachActivity=n,this.coachSettings=i,this.translate=r,this.events=h,this.audioPlayer=l,this.background=d,this.platform=f,this.trainingSettings=m,this.start=function(t,e){if(void 0===v.activeTraining){switch(t){case R.Posture:e instanceof c.b&&(v.activeTraining=new c.a(e,v.solosConnector,v.coachActivity,v.audioPlayer,v.translate,v.events,v.background,v.platform,v.trainingSettings));break;case R.Cadence:e instanceof o.b&&(v.activeTraining=new o.a(e,v.solosConnector,v.coachActivity,v.audioPlayer,v.translate,v.events,v.background,v.platform,v.trainingSettings));break;case R.Interval:e instanceof u.b&&(v.activeTraining=new u.a(e,v.solosConnector,v.coachActivity,v.audioPlayer,v.translate,v.events,v.background,v.platform,v.trainingSettings,v.coachSettings));break;case R.StepCount:e instanceof g.a&&(v.activeTraining=new g.b(e,v.solosConnector,v.coachActivity,v.audioPlayer,v.translate,v.events,v.background,v.platform,v.trainingSettings));break;case R.FastWalk:e instanceof p.b&&(v.activeTraining=new p.a(e,v.solosConnector,v.coachActivity,v.audioPlayer,v.translate,v.events,v.background,v.platform,v.trainingSettings));break;default:return!1}return v.events.subscribe(a.d,v.coachReminder),v.events.subscribe(a.i,v.coachStateChanged),v.events.subscribe(a.g,v.coachMetricDataChanged),v.events.subscribe(a.f,v.coachMetricDataChanged),v.activeTraining.start(e),!0}return!1},this.stop=function(){void 0!==v.activeTraining&&v.activeTraining.stop()},this.pause=function(){void 0!==v.activeTraining&&v.activeTraining.pause()},this.resume=function(){void 0!==v.activeTraining&&v.activeTraining.resume()},this.isRunning=function(){return!(void 0===v.activeTraining||!v.activeTraining.getBusy()&&v.activeTraining.getState()==s.i.Stopped)},this.getTrainingType=function(){if(void 0!==v.activeTraining){if(v.activeTraining instanceof c.a)return R.Posture;if(v.activeTraining instanceof o.a)return R.Cadence;if(v.activeTraining instanceof u.a)return R.Interval;if(v.activeTraining instanceof g.b)return R.StepCount;if(v.activeTraining instanceof p.a)return R.FastWalk}return null},this.getState=function(){return void 0!==v.activeTraining?v.activeTraining.getState():null},this.getBusy=function(){return void 0!==v.activeTraining?v.activeTraining.getBusy():null},this.getCoachMetricData=function(){return void 0!==v.activeTraining?v.activeTraining.getCoachMetricData():null},this.getCoachIsTrainingTimesup=function(){return void 0!==v.activeTraining?v.activeTraining.isTrainingTimesup():null},this.trainingDidStop=function(){void 0!==v.activeTraining&&(v.events.unsubscribe(a.d,v.coachReminder),v.events.unsubscribe(a.i,v.coachStateChanged),v.events.unsubscribe(a.g,v.coachMetricDataChanged),v.events.unsubscribe(a.f,v.coachMetricDataChanged),v.activeTraining=void 0)},this.coachReminder=function(t){void 0!==v.activeTraining&&v.activeTraining.coachReminder()},this.coachStateChanged=function(t){void 0!==v.activeTraining&&(t.state==a.j.Running?v.activeTraining.coachStarted():t.state==a.j.Paused?v.activeTraining.coachPaused():t.state==a.j.Idle?v.activeTraining.coachStopped():t.state==a.j.Busy&&v.activeTraining.setBusy())},this.coachMetricDataChanged=function(t){void 0!==v.activeTraining&&(v.activeTraining.coachMetricDataChanged(),v.activeTraining.isTrainingTimesup()&&v.stop())},this.events.subscribe(s.e,this.trainingDidStop)};return t.ngInjectableDef=m.ac({factory:function(){return new t(m.bc(r.l),m.bc(a.b),m.bc(d.a),m.bc(v.k),m.bc(i.f),m.bc(h.f),m.bc(l.a),m.bc(i.Mb),m.bc(f.e))},token:t,providedIn:"root"}),t}()},lGdP:function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return r})),n.d(e,"f",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return u})),n.d(e,"g",(function(){return h})),n.d(e,"h",(function(){return l})),n.d(e,"i",(function(){return g})),n.d(e,"k",(function(){return d})),n.d(e,"j",(function(){return p}));var i=n("BHc3"),a="evtTrainingStateStarted",r="evtTrainingStateStopped",s="evtTrainingStateStopping",c="evtTrainingStatePaused",o="evtTrainingStateBusy",u="evtTrainingMetricsChanged",h="tagSpeechIntervalReminder",l="tagSpeechPostureReminder",g=function(t){return t[t.Started=0]="Started",t[t.Paused=1]="Paused",t[t.Stopping=2]="Stopping",t[t.Stopped=3]="Stopped",t}({}),d=function t(e,n,i,a){_classCallCheck(this,t),this.running=!0,this.trainingTime=e,this.movingTimeOn=n,this.distanceOn=i,this.stepCountOn=a,this.useGPS=!0},p=function(){function t(e,n,i,a,r,s,c,u){var h=this;_classCallCheck(this,t),this.getState=function(){return h.state},this.updateMetricData=function(){h.movingTime=h.coachActivity.getMovingTime(),h.distance=h.coachActivity.getDistance(),h.stepCount=h.coachActivity.getStepCount(),h.calories=h.coachActivity.getCalories(),h.currentCadence=h.coachActivity.getCadence()},this.getBusy=function(){return h.busy},this.setBusy=function(){h.busy=!0,h.events.publish(o)},this.getTrainingTimeMS=function(){return void 0!==h.basecfg?1e3*h.basecfg.trainingTime:0},this.isTrainingTimesup=function(){var t=h.getTrainingTimeMS();return t>0&&h.movingTime>=t},this.solosConnector=e,this.coachActivity=n,this.audioPlayer=i,this.translate=a,this.events=r,this.background=s,this.platform=c,this.trainingSettings=u,this.state=g.Stopped,this.busy=!1,this.ttsTrainingStarted=this.translate.instant("training.training-started"),this.ttsTrainingResumed=this.translate.instant("training.training-resumed"),this.ttsTrainingPaused=this.translate.instant("training.training-paused"),this.ttsTrainingEnded=this.translate.instant("training.training-ended")}return _createClass(t,[{key:"start",value:function(t){if(this.state!=g.Stopped)return!1;this.basecfg=t,this.movingTime=0,this.distance=0,this.stepCount=0,this.calories=0,this.currentCadence=-1;var e=i.a.Running;return t.running||(e=i.a.Walking),this.coachActivity.start(!0,e,t.useGPS),!0}},{key:"pause",value:function(){return this.state==g.Started&&(this.coachActivity.pause(),!0)}},{key:"resume",value:function(){return this.state==g.Paused&&(this.coachActivity.resume(),!0)}},{key:"stop",value:function(){return(this.state==g.Started||this.state==g.Paused)&&(this.state=g.Stopping,this.events.publish(s),this.coachActivity.stop(),!0)}},{key:"getCoachMetricData",value:function(){return null}},{key:"beforeRunCoachReminder",value:function(){}},{key:"getSpokenTextWithMovingTime",value:function(){return this.coachActivity.getSpokenTextMovingTime(!0)}},{key:"getSpokenTextTotalDistance",value:function(){return this.coachActivity.getSpokenTextDistance()}},{key:"getSpokenTextStepCount",value:function(){return this.coachActivity.getSpokenTextStepCount(!0)}},{key:"coachReminder",value:function(){if(this.updateMetricData(),(this.basecfg.movingTimeOn||this.basecfg.distanceOn||this.basecfg.stepCountOn)&&(0==this.getTrainingTimeMS()||this.movingTime<this.getTrainingTimeMS())){this.beforeRunCoachReminder(),this.audioPlayer.flushPendingSpeech4tag(h);var t=!0;if(this.basecfg.movingTimeOn&&this.trainingSettings.getReminderTypeMovingTimeOn()){var e=this.getSpokenTextWithMovingTime();this.audioPlayer.speech(t,e,h),t=!1}if(this.basecfg.distanceOn&&this.trainingSettings.getReminderTypeDistanceOn()){var n=this.getSpokenTextTotalDistance();this.audioPlayer.speech(t,n,h),t=!1}if(this.basecfg.stepCountOn&&this.trainingSettings.getReminderStepCount()){var i=this.getSpokenTextStepCount();this.audioPlayer.speech(t,i,h),t=!1}this.afterRunCoachReminder()}}},{key:"afterRunCoachReminder",value:function(){}},{key:"coachMetricDataChanged",value:function(){this.state!=g.Stopping&&this.updateMetricData()}},{key:"started",value:function(){this.busy=!1,this.state=g.Started,this.events.publish(a)}},{key:"coachStarted",value:function(){var t=this;this.state==g.Stopped&&this.background.enable();var e=this.ttsTrainingStarted;this.state==g.Paused&&(e=this.ttsTrainingResumed),this.audioPlayer.flushPendingSpeech4tag(h),this.audioPlayer.flushPendingSpeech4tag(l),this.audioPlayer.speech(!0,e,"",(function(){t.started()}))}},{key:"paused",value:function(){this.busy=!1,this.state=g.Paused,this.events.publish(c)}},{key:"coachPaused",value:function(){var t=this;this.audioPlayer.flushPendingSpeech4tag(h),this.audioPlayer.flushPendingSpeech4tag(l),this.audioPlayer.speech(!0,this.ttsTrainingPaused,"",(function(){t.paused()}))}},{key:"stopped",value:function(){this.background.disable(),this.busy=!1,this.state=g.Stopped,this.events.publish(r)}},{key:"coachStopped",value:function(){this.state==g.Stopped?this.stopped():(this.audioPlayer.flushPendingSpeech4tag(h),this.audioPlayer.flushPendingSpeech4tag(l),this.audioPlayer.speech(!0,this.ttsTrainingEnded),this.stopped())}}]),t}()},lIDq:function(t,e,n){"use strict";n.d(e,"e",(function(){return c})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return l}));var i=n("mrSG"),a=n("ZZ/e"),r=n("8Y7J"),s=n("xgBC"),c="Metric",o="Imperial",u="evtCoachUnitChanged",h="evtCoachIntervalChanged",l=function(){var t=function t(e,n,a){var r=this;_classCallCheck(this,t),this.platform=e,this.storage=n,this.events=a,this.unit=c,this.reminderInterval=0,this.heartRate=!1,this.pacing=!1,this.avgPacing=!1,this.elapsedTime=!1,this.distance=!1,this.movingTime=!1,this.stepCount=!1,this.stride=!1,this.avgStride=!1,this.cadence=!1,this.avgCadence=!1,this.leftBalance=!1,this.rightBalance=!1,this.autoPause=!0,this.getKey=function(t){return"CoachSettings-"+t},this.setUnit=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!=o&&t!=c||t==this.unit){e.next=11;break}return this.unit=t,e.prev=2,e.next=5,this.storage.set(this.getKey("Unit"),t);case 5:this.events.publish(u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])})))},this.getUnit=function(){return r.unit},this.setReminderInterval=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>=0&&t!=this.reminderInterval)){e.next=11;break}return this.reminderInterval=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderInterval"),t);case 5:this.events.publish(h),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])})))},this.getReminderInterval=function(){return r.reminderInterval},this.setReminderHeartRateTypeOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.heartRate){e.next=10;break}return this.heartRate=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeHeartRate"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderHeartRateTypeOn=function(){return r.heartRate},this.setReminderTypePacingOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.pacing){e.next=10;break}return this.pacing=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypePacing"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypePacingOn=function(){return r.pacing},this.setReminderTypeAveragePacingOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.avgPacing){e.next=10;break}return this.avgPacing=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeAveragePacing"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeAveragePacingOn=function(){return r.avgPacing},this.setReminderTypeElapsedTimeOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.elapsedTime){e.next=10;break}return this.elapsedTime=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeElapsedTime"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeElapsedTimeOn=function(){return r.elapsedTime},this.setReminderTypeDistanceOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.distance){e.next=10;break}return this.distance=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeDistance"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeDistanceOn=function(){return r.distance},this.setReminderTypeMovingTimeOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.movingTime){e.next=10;break}return this.movingTime=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeMovingTime"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeMovingTimeOn=function(){return r.movingTime},this.setReminderTypeStepCountOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.stepCount){e.next=10;break}return this.stepCount=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeStepCount"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeStepCountOn=function(){return r.stepCount},this.setReminderTypeStrideOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.stride){e.next=10;break}return this.stride=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeStride"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeStrideOn=function(){return r.stride},this.setReminderTypeAverageStrideOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.avgStride){e.next=10;break}return this.avgStride=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeAverageStride"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeAverageStrideOn=function(){return r.avgStride},this.setReminderTypeCadenceOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.cadence){e.next=10;break}return this.cadence=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeCadence"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeCadenceOn=function(){return r.cadence},this.setReminderTypeAverageCadenceOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.avgCadence){e.next=10;break}return this.avgCadence=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeAverageCadence"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeAverageCadenceOn=function(){return r.avgCadence},this.setReminderTypeLeftBalanceOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.leftBalance){e.next=10;break}return this.leftBalance=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeLeftBalance"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeLeftBalanceOn=function(){return r.leftBalance},this.setReminderTypeRightBalanceOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.rightBalance){e.next=10;break}return this.rightBalance=t,e.prev=2,e.next=5,this.storage.set(this.getKey("ReminderTypeRightBalance"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getReminderTypeRightBalanceOn=function(){return r.rightBalance},this.setCoachAutoPauseOn=function(t){return i.b(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t==this.autoPause){e.next=10;break}return this.autoPause=t,e.prev=2,e.next=5,this.storage.set(this.getKey("CoachAutoPause"),t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})))},this.getCoachAutoPauseOn=function(){return r.autoPause},this.platform.ready().then((function(){r.storage.get(r.getKey("Unit")).then((function(t){null!=t&&(r.unit=t)})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderInterval")).then((function(t){null!=t&&(r.reminderInterval=Number(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeHeartRate")).then((function(t){null!=t&&(r.heartRate=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypePacing")).then((function(t){null!=t&&(r.pacing=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeAveragePacing")).then((function(t){null!=t&&(r.avgPacing=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeElapsedTime")).then((function(t){null!=t&&(r.elapsedTime=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeDistance")).then((function(t){null!=t&&(r.distance=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeMovingTime")).then((function(t){null!=t&&(r.movingTime=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeStepCount")).then((function(t){null!=t&&(r.stepCount=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeStride")).then((function(t){null!=t&&(r.stride=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeAverageStride")).then((function(t){null!=t&&(r.avgStride=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeCadence")).then((function(t){null!=t&&(r.cadence=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeAverageCadence")).then((function(t){null!=t&&(r.avgCadence=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeLeftBalance")).then((function(t){null!=t&&(r.leftBalance=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("ReminderTypeRightBalance")).then((function(t){null!=t&&(r.rightBalance=Boolean(t))})).catch((function(t){console.log(t)})),r.storage.get(r.getKey("CoachAutoPause")).then((function(t){null!=t&&(r.autoPause=Boolean(t))})).catch((function(t){console.log(t)}))}))};return t.ngInjectableDef=r.ac({factory:function(){return new t(r.bc(a.Mb),r.bc(s.b),r.bc(a.f))},token:t,providedIn:"root"}),t}()},xVX2:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return o}));var i=n("lGdP"),a=n("8qa8"),r=n("lIDq"),s=.015,c=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,a,r,s,c){var o;return _classCallCheck(this,n),(o=e.call(this,t,!0,!0,!1)).type=i,o.runDistance=a,o.runTime=r,o.restTime=s,o.interval=c,o}return n}(i.k),o=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,c,o,u,h,l,g,d,p,f){var m;return _classCallCheck(this,n),(m=e.call(this,c,o,u,h,l,g,d,p)).beepSoundOn=!1,m.runRestStateTransitionStarted=function(){m.getState()==i.i.Started&&1!=m.getBusy()&&(m.switchingRunRestState||(m.switchingRunRestState=!0,m.startBeepSound()))},m.runRestStateTransitionEnded=function(t){if(m.switchingRunRestState&&(m.switchingRunRestState=!1,m.stopBeepSound()),void 0!==t)switch(t){case 0:m.distanceRef=m.distance,m.timeRef=m.movingTime,m.lastDistance=m.distance,m.lastMovingTime=m.movingTime,m.speechStartRunning(),m.runPendingCoachReminder();break;case 1:m.distanceRef=m.distance,m.timeRef=m.movingTime,m.lastDistance=m.distance,m.lastMovingTime=m.movingTime,m.speechSlowDown(),m.runPendingCoachReminder();break;case 2:m.audioPlayer.speech(!0,m.translate.instant("training.all-sets-are-completed")),m.stop()}},m.runPendingCoachReminder=function(){m.pendingCoachReminder&&(m.pendingCoachReminder=!1,m.coachReminder())},m.speechStartRunning=function(){m.currentState=1,m.audioPlayer.speech(!1,m.translate.instant("training.num-of-sets",{x:m.currInterval+1})+m.translate.instant("training.start-run")),m.coachActivity.setMovingTimeAlwaysOn(!1)},m.speechSlowDown=function(){m.currentState=2,m.audioPlayer.speech(!1,m.translate.instant("training.slow-down-n-rest")),m.coachActivity.setMovingTimeAlwaysOn(!0)},m.startBeepSound=function(){if(!m.beepSoundOn){m.beepSoundOn=!0,m.audioPlayer.flushPendingSpeech4tag(i.g);var t=m.trainingSettings.getBeepVolume();m.audioPlayer.setVolume(a.a,t),m.audioPlayer.playMusic(!1,a.a,"",60)}},m.stopBeepSound=function(){m.beepSoundOn&&(m.beepSoundOn=!1,m.audioPlayer.stopMusic(a.a))},m.getAlertDistance=function(){var t=s;return m.coachSettings.getUnit()==r.d?m.cfgRunDistance-.62137*t:m.cfgRunDistance-t},m.publishTrainingMetricsChangedEvent=function(){m.events.publish(i.a,m.getCoachMetricData())},m.getSpokenTextTotalDistance=function(){return m.translate.instant("training.curr-run-distance-is")+" "+m.totalRunDistance.toFixed(2)+m.translate.instant(m.coachSettings.getUnit()==r.d?"ai-coach.miles":"ai-coach.k-m")},m.cfg=t,m.coachSettings=f,m}return _createClass(n,[{key:"start",value:function(t){if(!_get(_getPrototypeOf(n.prototype),"start",this).call(this,t))return!1;this.currentState=0,this.distanceRef=0,this.totalRunDistance=0,this.lastDistance=0,this.currInterval=0,this.timeRef=0,this.totalRunTime=0,this.totalRestTime=0,this.lastMovingTime=0,this.switchingRunRestState=!1,this.pendingCoachReminder=!1,this.cfgRunDistance=this.coachSettings.getUnit()==r.d?.62137*this.cfg.runDistance:this.cfg.runDistance,this.restTimeLeft=-1}},{key:"stop",value:function(){return!!_get(_getPrototypeOf(n.prototype),"stop",this).call(this)&&(this.coachActivity.setMovingTimeAlwaysOn(!1),!0)}},{key:"coachMetricDataChanged",value:function(){if(_get(_getPrototypeOf(n.prototype),"coachMetricDataChanged",this).call(this),this.getState()==i.i.Started){if(0==this.currentState)this.speechStartRunning();else if(1==this.currentState)if(this.totalRunDistance+=this.distance-this.lastDistance,this.lastDistance=this.distance,"distance"==this.cfg.type){var t=this.distance-this.distanceRef;t>=this.getAlertDistance()&&t<this.cfgRunDistance?this.runRestStateTransitionStarted():t>=this.cfgRunDistance&&this.runRestStateTransitionEnded(1)}else{this.totalRunTime+=(this.movingTime-this.lastMovingTime)/1e3,this.lastMovingTime=this.movingTime;var e=(this.movingTime-this.timeRef)/1e3;e>=60*this.cfg.runTime-6&&e<60*this.cfg.runTime?this.runRestStateTransitionStarted():e>=60*this.cfg.runTime&&this.runRestStateTransitionEnded(1)}else if(2==this.currentState){this.totalRestTime+=(this.movingTime-this.lastMovingTime)/1e3,this.lastMovingTime=this.movingTime;var a=(this.movingTime-this.timeRef)/1e3;this.restTimeLeft=this.cfg.restTime-a,a>=this.cfg.restTime-6&&a<this.cfg.restTime?this.runRestStateTransitionStarted():a>=this.cfg.restTime&&(this.currInterval++,this.currInterval>=this.cfg.interval?(this.restTimeLeft=-1,this.runRestStateTransitionEnded(2)):(this.restTimeLeft=-1,this.runRestStateTransitionEnded(0)))}this.publishTrainingMetricsChangedEvent()}else this.publishTrainingMetricsChangedEvent()}},{key:"coachReminder",value:function(){this.switchingRunRestState?this.pendingCoachReminder=!0:_get(_getPrototypeOf(n.prototype),"coachReminder",this).call(this)}},{key:"getCoachMetricData",value:function(){return{type:this.cfg.type,movingTime:this.movingTime,distance:this.distance,runDistance:this.totalRunDistance,runTime:this.totalRunTime,restTime:this.totalRestTime,interval:this.currInterval,restTimeLeft:this.restTimeLeft}}},{key:"paused",value:function(){this.runRestStateTransitionEnded(),_get(_getPrototypeOf(n.prototype),"paused",this).call(this)}},{key:"stopped",value:function(){var t=this;this.runRestStateTransitionEnded();var e=this.getSpokenTextWithMovingTime();if(this.audioPlayer.speech(!1,e),e=_get(_getPrototypeOf(n.prototype),"getSpokenTextTotalDistance",this).call(this),this.audioPlayer.speech(!1,e),"distance"==this.cfg.type){e=this.coachSettings.getUnit()==r.d?this.translate.instant("training.run-distance-is")+" "+this.totalRunDistance.toFixed(2)+this.translate.instant("training.mi"):this.translate.instant("training.run-distance-is")+" "+this.totalRunDistance.toFixed(2)+this.translate.instant("training.km"),this.audioPlayer.speech(!1,e);var i=Math.floor(this.totalRestTime/60),a=Math.floor(this.totalRestTime%60);e=this.translate.instant("training.rest-time-is")+(0==i?"":i+this.translate.instant("training.minutes"))+(0==a&&0!=i?"":a+this.translate.instant("training.sec")),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}else{var s=Math.floor(this.totalRunTime/60),c=Math.floor(this.totalRunTime%60),o=Math.floor(this.totalRestTime/60),u=Math.floor(this.totalRestTime%60);e=this.translate.instant("training.run-time-is")+(0==s?"":s+this.translate.instant("training.minutes"))+(0==c&&0!=s?"":c+this.translate.instant("training.sec")),this.audioPlayer.speech(!1,e),e=this.translate.instant("training.rest-time-is")+(0==o?"":o+this.translate.instant("training.minutes"))+(0==u&&0!=o?"":u+this.translate.instant("training.sec")),this.audioPlayer.speech(!1,e,"",(function(){_get(_getPrototypeOf(n.prototype),"stopped",t).call(t)}))}}}]),n}(i.j)},yDgC:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=1,a=function t(){var e=this;_classCallCheck(this,t),this.timers={},this.addTimer=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,c=i++,o=new r(t,n,a,s),u=String(c);return e.timers[u]=o,c},this.removeTimer=function(t){var n=String(t);null!=e.timers[n]&&delete e.timers[n]},this.changeInterval=function(t,n){var i=String(t);null!=e.timers[i]&&(0!=n&&(e.timers[i].tNow=e.timers[i].tTotal%n),e.timers[i].tInterval=n)},this.update=function(t){for(var n in e.timers)e.timers[n].isStop()||e.timers[n].update(t),e.timers[n].isStop()&&delete e.timers[n]}},r=function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;_classCallCheck(this,t),this.para=void 0,this.tTotal=0,this.tNow=0,this.tInterval=0,this.once=!1,this.stop=!1,this.update=function(t){i.stop||(i.tTotal+=t,0!=i.tInterval&&(i.tNow+=t,i.tNow>=i.tInterval&&(i.tNow%=i.tInterval,i.fn(i.para),i.once&&(i.stop=!0))))},this.isStop=function(){return i.stop},this.fn=e,this.tInterval=n,this.once=a,this.para=r}}}]);