(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"0/40":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a("qX8T"),r=a("bqTn");class n extends s.a{constructor(e=null,t=null,a=null){super(e,e,t,a),this.allTrainingDays=()=>{let e=[],t=new Date(this.fromDate);for(let a=0;a<28;a++)e.push(new Date(t)),t.setDate(t.getDate()+1);return e},null!==this.toDate&&(this.toDate=new Date,this.toDate.setDate(e.getDate()+27),this.toDate.setHours(23,59,59,0),this.type=r.c.fourWeeksProgram)}}},"7JKF":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a("qX8T"),r=a("bqTn");class n extends s.a{constructor(e=null,t=null,a=null){super(e,e,t,a),this.allTrainingDays=()=>{let e=[],t=new Date(this.fromDate);for(let a=0;a<14;a++)e.push(new Date(t)),t.setDate(t.getDate()+1);return e},null!==this.toDate&&(this.toDate=new Date,this.toDate.setDate(e.getDate()+13),this.toDate.setHours(23,59,59,0),this.type=r.c.twoWeeksProgram)}}},"UJ+M":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a("qX8T"),r=a("bqTn");class n extends s.a{constructor(e=null,t=null,a=null){super(e,e,t,a),this.allTrainingDays=()=>{let e=[],t=new Date(this.fromDate);for(let a=0;a<7;a++)e.push(new Date(t)),t.setDate(t.getDate()+1);return e},null!==this.toDate&&(this.toDate=new Date,this.toDate.setDate(e.getDate()+6),this.toDate.setHours(23,59,59,0),this.type=r.c.oneWeekProgram)}}},bqTn:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return r})),a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return i})),a.d(t,"f",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"g",(function(){return u}));const s="CoreExerciseProgram",r="LocalNotification";var n=function(e){return e[e.Scheduled=0]="Scheduled",e[e.Unscheduled=1]="Unscheduled",e[e.Completed=2]="Completed",e[e.ScheduledCompleted=3]="ScheduledCompleted",e[e.Failed=4]="Failed",e}({}),i=function(e){return e.None="NONE",e.Normal="NORMAL",e.Destoryed="DESTROYED",e}({}),o=function(e){return e.None="NONE",e.Time="TIME",e.Calories="CALORIES",e}({}),l=function(e){return e.oneWeekProgram="oneWeekProgram",e.twoWeeksProgram="twoWeeksProgram",e.fourWeeksProgram="fourWeeksProgram",e}({});class u{constructor(e=o.None,t=0){this.targetType=e,this.value=t}}},j1ZV:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));class s{}},qX8T:function(e,t,a){"use strict";var s=a("bqTn");let r=(()=>{class e{constructor(e,t,a){this.getFromDate=()=>this.fromDate,this.setFromDate=e=>{this.fromDate=new Date(e),this.fromDate.setHours(0,0,0,0)},this.getToDate=()=>this.toDate,this.setToDate=e=>{this.toDate=new Date(e),this.toDate.setHours(23,59,59,0)},this.getTarget=()=>this.target,this.setTarget=e=>{this.target=e},this.setProgramState=e=>{this.programState=e},this.getProgramState=()=>this.programState,this.hasTargetFulfilled=(e,t)=>{switch(t.targetType){case s.f.None:return 1===e.completion;case s.f.Time:return e.totalDurInMS>=t.value;case s.f.Calories:return e.calories>=t.value;default:return!1}},this.fromDate=e,this.toDate=t,this.target=a,this.programState=s.a.Normal}progressCalculate(e){const t=this.calculateDayStatus(e),a=t.filter(e=>e.status===s.b.ScheduledCompleted),r=this.getScheduledTrainingDays().length;return{progress:t,completion:a.length/r}}calculateDayStatus(e){return null}}return e.str2ProgramState=e=>e===s.a.Normal?s.a.Normal:e===s.a.Destoryed?s.a.Destoryed:s.a.None,e})();a.d(t,"a",(function(){return n}));class n extends r{constructor(e=null,t=null,a=null,s=null){super(e,t,a),this.setWeekDayEnable=(e,t)=>{this.weekDayEnable[e]=t,this.totalDayEnabledWeekly++},this.allTrainingDays=()=>[],this.getWeekDayEnable=()=>this.weekDayEnable,this.getTotalDayEnabledWeekly=()=>this.totalDayEnabledWeekly,this.weekDayEnable=s,null!==this.weekDayEnable&&(this.totalDayEnabledWeekly=this.weekDayEnable.filter(e=>e).length)}getPackedSettings(){return{type:this.type,fromDate:this.fromDate,toDate:this.toDate,target:this.target,trainingTarget:this.target,programState:this.programState,settings:{everySun:this.weekDayEnable[0],everyMon:this.weekDayEnable[1],everyTue:this.weekDayEnable[2],everyWed:this.weekDayEnable[3],everyThu:this.weekDayEnable[4],everyFri:this.weekDayEnable[5],everySat:this.weekDayEnable[6]}}}unpackSettings(e){this.fromDate=e.getFromDate(),this.toDate=e.getToDate(),this.programState=r.str2ProgramState(e.getProgramState()),this.target=e.getTrainingTarget();const t=e.getSettings();this.weekDayEnable=Object.keys(t).map(e=>t[e]),this.totalDayEnabledWeekly=this.weekDayEnable.filter(e=>e).length}calculateDayStatus(e){let t=this.allTrainingDays().map(e=>({date:e,status:this.isTodayScheduled(e)?s.b.Scheduled:s.b.Unscheduled}));e.forEach(e=>{const a=t.map(e=>e.date.getTime()).indexOf(e.startTime.getTime());-1!==a&&this.hasTargetFulfilled(e,this.target)&&(t[a].status=this.isTodayScheduled(e.startTime)?s.b.ScheduledCompleted:s.b.Completed)});let a=new Date;a.setHours(0,0,0,0);const r=t.map(e=>e.date.getTime()).indexOf(a.getTime());let n=null;for(let o=0;o<=r;o++)t[o].status===s.b.Scheduled?n=t[o]:t[o].status===s.b.ScheduledCompleted?n=null:t[o].status===s.b.Completed&&null!==n&&(n.status=s.b.Unscheduled,t[o].status=s.b.ScheduledCompleted,n=null);if(t[r].status===s.b.Unscheduled)for(let o=r-1;o>=0;o--){if(t[o].status===s.b.Scheduled){t[o].status=s.b.Unscheduled,t[r].status=s.b.Scheduled;break}if(t[o].status!==s.b.Unscheduled)break}let i=null;for(let o=0;o<r;o++)t[o].status===s.b.Completed?i=t[o]:t[o].status===s.b.ScheduledCompleted?i=null:t[o].status===s.b.Scheduled&&null!==i&&(i.status=s.b.ScheduledCompleted,t[o].status=s.b.Unscheduled,i=null);return t.filter(e=>e.status===s.b.Scheduled&&e.date.getTime()<a.getTime()).forEach(e=>{e.status=s.b.Failed}),t}isTodayScheduled(e){return this.weekDayEnable[e.getDay()]}getScheduledTrainingDays(){return this.allTrainingDays().filter(e=>this.weekDayEnable[e.getDay()])}}},tdY7:function(e,t,a){"use strict";var s=a("mrSG"),r=a("Z18M"),n=a("UJ+M"),i=a("7JKF"),o=a("0/40"),l=a("bqTn");let u=(()=>{class e{}return e.createProgramSetting=e=>e===l.c.oneWeekProgram?new n.a:e===l.c.twoWeeksProgram?new i.a:e===l.c.fourWeeksProgram?new o.a:null,e})();const c=()=>(()=>{const e=new Date("October 3, 2020 00:00:00"),t=new Date("September 30, 2020 00:00:00"),a=new Date(t);a.setDate(a.getDate()+27);const s=new Date(e);s.setHours(0,0,0,0);const r=new Date(e);r.setHours(8,2,0,0);const n=r.getTime()-s.getTime();return{today:e,fromDate:t,toDate:a,coreExercise:[{startTime:new Date("October 1, 2020 00:00:00"),endTime:r,totalDurInMS:n,calories:100,completion:1},{startTime:new Date("October 2, 2020 00:00:00"),endTime:r,totalDurInMS:n,calories:100,completion:1}]}})(),d={todayTestData:c().today,toDateTestData:c().toDate,fromDateTestData:c().fromDate,coreExerciseTestData:c().coreExercise};var h=a("8Y7J"),g=a("xgBC"),D=a("TSSN");a.d(t,"a",(function(){return b}));const m=new o.a(d.fromDateTestData,new l.g,[!1,!1,!1,!0,!0,!1,!1]);let b=(()=>{class e{constructor(e,t,a){this.backend=e,this.storage=t,this.translate=a,this.debug=!1,this.getKey=e=>l.d+"-"+e,this.setNextReminderNotification=()=>s.b(this,void 0,void 0,(function*(){})),this.addProgram=e=>s.b(this,void 0,void 0,(function*(){if((yield this.backend.getCoreExercisePlanSettings(new Date,new Date)).length>0)return!1;const t=e.getPackedSettings();try{return yield this.backend.saveCoreExercisePlanSettings(t.type,t.fromDate,t.toDate,t.settings,t.trainingTarget,t.programState),!0}catch(a){return!1}})),this.deleteProgram=()=>s.b(this,void 0,void 0,(function*(){const e=yield this.backend.getCoreExercisePlanSettings(new Date,new Date);if(0===e.length)return!1;try{return yield this.backend.removeCoreExercisePlanSettings(e[0].id),!0}catch(t){return console.log(t),!1}})),this.getProgramSettings=()=>s.b(this,void 0,void 0,(function*(){const e=yield this.backend.getCoreExercisePlanSettings(new Date,new Date);if(0===e.length)return null;const t=u.createProgramSetting(e[0].getType());return t.unpackSettings(e[0]),t})),this.getProgramProgress=(e,t)=>s.b(this,void 0,void 0,(function*(){let a,s=yield this.backend.getCoreExercisePlanSettings(e,t);if(0===s.length)return null;this.debug?a=m:(a=u.createProgramSetting(s[0].getType())).unpackSettings(s[0]);let r=((e,t)=>e.reduce((e,t)=>{let a=t.startTime;return e[a]=e[a]||[],e[a].push(t),e},{}))((yield this.backend.queryCoreExercises4Dates(e,t,1e3)).map(e=>{const t=e.getStartTime();return t.setHours(0,0,0,0),{startTime:t,endTime:e.getEndTime(),totalDurInMS:e.getTotalDurInMS(),calories:e.getCalories(),completion:e.getCompletion(),result:e.getResult()}}));const n=Object.keys(r).map(e=>({startTime:new Date(e),endTime:r[e].map(e=>e.endTime)[r[e].length-1],totalDurInMS:r[e].reduce((e,t)=>e+t.totalDurInMS,0),calories:r[e].reduce((e,t)=>e+t.calories,0),completion:r[e].reduce((e,t)=>1===e||1===t.completion?1:0,0)}));return a.progressCalculate(this.debug?d.coreExerciseTestData:n)})),this.getShowTodayReminder=()=>s.b(this,void 0,void 0,(function*(){const e=yield this.storage.get(this.getKey(l.e));return void 0===e||e<new Date}))}}return e.ngInjectableDef=h.ac({factory:function(){return new e(h.bc(r.c),h.bc(g.b),h.bc(D.k))},token:e,providedIn:"root"}),e})()}}]);