(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{pXS3:function(n,l,t){"use strict";t.r(l);var o=t("8Y7J"),e=t("mrSG"),i=t("ZZ/e"),u=t("J7vL"),c=t("OUMn");const s="Coupons",r="RegionCode";class b{constructor(n,l,t,o,i,u){this.couponsService=n,this.navCtrl=l,this.popupCtrl=t,this.translate=o,this.storage=i,this.zone=u,this.regionText="",this.regions=[],this.regionCodes=[],this.onCouponClicked=(n,l)=>e.b(this,void 0,void 0,(function*(){try{if(l.redeemed()||l.expired())this.onCouponInfoClicked(n,l);else{const n={state:{title:l.title,desc:l.desc,code:l.code,qrcode:l.qrCode()}};yield this.navCtrl.navigateForward("/coupon-code",n)}}catch(t){console.log(t)}})),this.onCouponInfoClicked=(n,l)=>e.b(this,void 0,void 0,(function*(){try{const n={state:{tc:l.tc,redeemedAt:l.redeemedAt,expiredAt:l.expiredAt}};yield this.navCtrl.navigateForward("/coupon-info",n)}catch(n){console.log(n)}})),this.reloadCoupons=()=>{this.infiniteScroll.disabled=!1,this.coupons=[],this.loadCoupons(null)},this.loadCoupons=n=>{this.downloadCoupons(this.coupons.length>0?this.coupons[this.coupons.length-1].issuedAt:new Date,this.currentRegionCode)},this.downloadCoupons=(n,l)=>e.b(this,void 0,void 0,(function*(){try{const t=yield this.couponsService.getCoupons(n,10,l);this.coupons=this.coupons.concat(t),this.infiniteScroll.complete(),10!=t.length&&(this.infiniteScroll.disabled=!0)}catch(t){this.infiniteScroll.complete(),this.infiniteScroll.disabled=!0}this.virtualScroll.checkEnd()})),this.regionClicked=()=>e.b(this,void 0,void 0,(function*(){let n=[];n.push({name:"regions",options:this.popupCtrl.getColumnOptions(this.regions),selectedIndex:this.getRegionIndex(this.currentRegionCode)}),this.popupCtrl.presentNativePickerController(n,n=>e.b(this,void 0,void 0,(function*(){try{this.zone.run(()=>{const l=n[0].description;this.regionText=l,this.currentRegionCode=this.getRegionCode(l),this.saveLastRegionCode(this.currentRegionCode),this.reloadCoupons()})}catch(l){console.log(l)}})))})),this.loadLastRegionCode=()=>e.b(this,void 0,void 0,(function*(){let n="HKG";try{if(null==(n=yield this.storage.get(this.getKey(r))))return"HKG"}catch(l){console.log(l)}return n})),this.saveLastRegionCode=n=>e.b(this,void 0,void 0,(function*(){try{yield this.storage.set(this.getKey(r),n)}catch(l){console.log(l)}})),this.getRegionCode=n=>Object.keys(this.regionInfo).find(l=>this.regionInfo[l]===n),this.getRegionIndex=n=>this.regionCodes.findIndex(l=>l===n),this.getKey=n=>s+"-"+n}ngOnInit(){this.regionInfo=this.translate.instant("region"),this.regions=Object.values(this.regionInfo),this.regionCodes=Object.keys(this.regionInfo)}ionViewWillEnter(){return e.b(this,void 0,void 0,(function*(){this.loadLastRegionCode().then(n=>{this.currentRegionCode=n,this.regionText=this.translate.instant(`region.${n}`),this.reloadCoupons()})}))}ionViewDidEnter(){}ionViewWillLeave(){}ionViewDidLeave(){}}class a{}var p=t("pMnS"),d=t("SVse"),g=t("oBZk"),h=t("TSSN"),x=t("xgBC"),f=o.Ab({encapsulation:0,styles:[[".coupon[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;padding:10px 0;width:100%}.redeemed[_ngcontent-%COMP%]{opacity:.4}.not-redeemed[_ngcontent-%COMP%]{opacity:1}.coupon-left[_ngcontent-%COMP%]{background:url(coupon-01.b04d2eef4044a80b81cb.png) no-repeat;width:8px;height:196px}.coupon-left-body[_ngcontent-%COMP%]{background:url(coupon-04.3ef93221d0ac83eb2c52.png) repeat-x;width:18%;height:196px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:start;justify-content:start;-webkit-box-align:center;align-items:center}.coupon-left-text-container[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%}.coupon-left-text[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:30px;font-weight:700;-webkit-writing-mode:vertical-rl;-ms-writing-mode:tb-rl;writing-mode:vertical-rl;-webkit-text-orientation:mixed;text-orientation:mixed;text-align:center;white-space:pre-wrap}.coupon-mid[_ngcontent-%COMP%]{background:url(coupon-02.27518f05f88f344b277a.png) no-repeat;width:31px;height:196px}.coupon-right-body[_ngcontent-%COMP%]{background:url(coupon-04.3ef93221d0ac83eb2c52.png) repeat-x;width:calc(100% - 20% - 20px - 20px - 8px - 31px - 9px);height:196px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;padding:5px}.coupon-title[_ngcontent-%COMP%]{color:var(--solos-color-d);width:100%;font-size:20px;text-align:center;padding:2px;border-width:1px;border-color:var(--solos-color-d);border-style:dashed}.coupon-desc[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:12px;line-height:17px;height:100%;padding:5px 0;white-space:pre-wrap}.coupon-footer[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;width:100%}.coupon-num-exp[_ngcontent-%COMP%]{color:var(--solos-color-a);font-size:9px;line-height:12px;width:100%;font-weight:100}.qrcode-icon[_ngcontent-%COMP%]{margin:5px;width:22px;height:22px}.info-icon[_ngcontent-%COMP%]{align-self:flex-start;margin-bottom:15px;margin-left:5px;width:22px;height:22px}.coupon-right[_ngcontent-%COMP%]{background:url(coupon-03.8f62eda0e2fb364a4d99.png) no-repeat;width:9px;height:196px}"]],data:{}});function C(n){return o.Xb(0,[(n()(),o.Cb(0,0,null,null,26,"div",[["class","coupon"]],null,null,null,null,null)),o.Sb(512,null,d.u,d.v,[o.x,o.y,o.p,o.L]),o.Bb(2,278528,null,0,d.j,[d.u],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(n()(),o.Cb(3,0,null,null,0,"div",[["class","coupon-left"]],null,null,null,null,null)),(n()(),o.Cb(4,0,null,null,5,"div",[["class","coupon-left-body"]],null,[[null,"click"]],(function(n,l,t){var o=!0;return"click"===l&&(o=!1!==n.component.onCouponInfoClicked(t,n.context.$implicit)&&o),o}),null,null)),(n()(),o.Cb(5,0,null,null,2,"div",[["class","coupon-left-text-container"]],null,null,null,null,null)),(n()(),o.Cb(6,0,null,null,1,"div",[["class","coupon-left-text"]],null,null,null,null,null)),(n()(),o.Vb(7,null,[" "," "])),(n()(),o.Cb(8,0,null,null,1,"ion-icon",[["class","info-icon"],["slot","icon-only"],["src","assets/imgs/coupon-06.svg"]],null,null,null,g.R,g.j)),o.Bb(9,49152,null,0,i.E,[o.j,o.p,o.F],{src:[0,"src"]},null),(n()(),o.Cb(10,0,null,null,0,"div",[["class","coupon-mid"]],null,null,null,null,null)),(n()(),o.Cb(11,0,null,null,14,"div",[["class","coupon-right-body"]],null,[[null,"click"]],(function(n,l,t){var o=!0;return"click"===l&&(o=!1!==n.component.onCouponClicked(t,n.context.$implicit)&&o),o}),null,null)),(n()(),o.Cb(12,0,null,null,1,"div",[["class","coupon-title"]],null,null,null,null,null)),(n()(),o.Vb(13,null,[" "," "])),(n()(),o.Cb(14,0,null,null,1,"div",[["class","coupon-desc"]],null,null,null,null,null)),(n()(),o.Vb(15,null,[" "," "])),(n()(),o.Cb(16,0,null,null,9,"div",[["class","coupon-footer"]],null,null,null,null,null)),(n()(),o.Cb(17,0,null,null,6,"div",[["class","coupon-num-exp"]],null,null,null,null,null)),(n()(),o.Vb(18,null,[" ","\xa0"," "])),o.Pb(131072,h.j,[h.k,o.j]),(n()(),o.Cb(20,0,null,null,0,"br",[],null,null,null,null,null)),(n()(),o.Vb(21,null,[" ","\xa0"," "])),o.Pb(131072,h.j,[h.k,o.j]),o.Rb(23,2),(n()(),o.Cb(24,0,null,null,1,"ion-icon",[["class","qrcode-icon"],["slot","icon-only"],["src","assets/imgs/coupon-05.svg"]],null,null,null,g.R,g.j)),o.Bb(25,49152,null,0,i.E,[o.j,o.p,o.F],{src:[0,"src"]},null),(n()(),o.Cb(26,0,null,null,0,"div",[["class","coupon-right"]],null,null,null,null,null))],(function(n,l){var t=l.context.$implicit.redeemed()||l.context.$implicit.expired()?"redeemed":"not-redeemed";n(l,2,0,"coupon",t),n(l,9,0,"assets/imgs/coupon-06.svg"),n(l,25,0,"assets/imgs/coupon-05.svg")}),(function(n,l){n(l,7,0,l.context.$implicit.discountHighlight),n(l,13,0,l.context.$implicit.title),n(l,15,0,l.context.$implicit.desc),n(l,18,0,o.Wb(l,18,0,o.Ob(l,19).transform("coupon.coupon-num")),l.context.$implicit.code);var t=o.Wb(l,21,0,o.Ob(l,22).transform("coupon.exp")),e=o.Wb(l,21,1,n(l,23,0,o.Ob(l.parent,0),l.context.$implicit.expiredAt,"dd LLL yy"));n(l,21,0,t,e)}))}function m(n){return o.Xb(0,[o.Pb(0,d.d,[o.z]),o.Tb(671088640,1,{virtualScroll:0}),o.Tb(671088640,2,{infiniteScroll:0}),(n()(),o.Cb(3,0,null,null,12,"ion-header",[],null,null,null,g.Q,g.i)),o.Bb(4,49152,null,0,i.D,[o.j,o.p,o.F],null,null),(n()(),o.Cb(5,0,null,0,10,"ion-toolbar",[["class","settings-header-background"],["mode","ios"]],null,null,null,g.ob,g.G)),o.Bb(6,49152,null,0,i.Db,[o.j,o.p,o.F],{mode:[0,"mode"]},null),(n()(),o.Cb(7,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,g.L,g.d)),o.Bb(8,49152,null,0,i.n,[o.j,o.p,o.F],null,null),(n()(),o.Cb(9,0,null,0,2,"ion-back-button",[["class","settings-back-button"],["text",""]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==o.Ob(n,11).onClick(t)&&e),e}),g.J,g.b)),o.Bb(10,49152,null,0,i.i,[o.j,o.p,o.F],{text:[0,"text"]},null),o.Bb(11,16384,null,0,i.j,[[2,i.jb],i.Jb],null,null),(n()(),o.Cb(12,0,null,0,3,"ion-title",[["class","settings-header-title"]],null,null,null,g.mb,g.E)),o.Bb(13,49152,null,0,i.Bb,[o.j,o.p,o.F],null,null),(n()(),o.Vb(14,0,["",""])),o.Pb(131072,h.j,[h.k,o.j]),(n()(),o.Cb(16,0,null,null,21,"ion-content",[["class","app-background"]],null,null,null,g.O,g.g)),o.Bb(17,49152,null,0,i.w,[o.j,o.p,o.F],null,null),(n()(),o.Cb(18,0,null,0,8,"ion-item",[["button",""],["class","settings-item"],["detail",""]],null,[[null,"click"]],(function(n,l,t){var o=!0;return"click"===l&&(o=!1!==n.component.regionClicked()&&o),o}),g.W,g.o)),o.Bb(19,49152,null,0,i.J,[o.j,o.p,o.F],{button:[0,"button"],detail:[1,"detail"]},null),(n()(),o.Cb(20,0,null,0,3,"ion-label",[["color","settings-left-label"]],null,null,null,g.X,g.p)),o.Bb(21,49152,null,0,i.P,[o.j,o.p,o.F],{color:[0,"color"]},null),(n()(),o.Vb(22,0,["",""])),o.Pb(131072,h.j,[h.k,o.j]),(n()(),o.Cb(24,0,null,0,2,"ion-label",[["class","ion-text-right"],["color","settings-right-label"]],null,null,null,g.X,g.p)),o.Bb(25,49152,null,0,i.P,[o.j,o.p,o.F],{color:[0,"color"]},null),(n()(),o.Vb(26,0,["",""])),(n()(),o.Cb(27,0,null,0,6,"ion-virtual-scroll",[["approxItemHeight","210px"]],null,null,null,g.pb,g.H)),o.Bb(28,835584,[[1,4],["virtualScroll",4]],3,i.Eb,[o.F,o.x,o.p],{approxItemHeight:[0,"approxItemHeight"],items:[1,"items"]},null),o.Tb(335544320,3,{itmTmp:0}),o.Tb(335544320,4,{hdrTmp:0}),o.Tb(335544320,5,{ftrTmp:0}),(n()(),o.rb(16777216,null,0,1,null,C)),o.Bb(33,16384,[[3,4]],0,i.Rb,[o.T,o.X],null,null),(n()(),o.Cb(34,0,null,0,3,"ion-infinite-scroll",[["threshold","100px"]],null,[[null,"ionInfinite"]],(function(n,l,t){var o=!0;return"ionInfinite"===l&&(o=!1!==n.component.loadCoupons(t)&&o),o}),g.U,g.l)),o.Bb(35,49152,[[2,4],["infiniteScroll",4]],0,i.G,[o.j,o.p,o.F],{threshold:[0,"threshold"]},null),(n()(),o.Cb(36,0,null,0,1,"ion-infinite-scroll-content",[["loadingSpinner","bubbles"]],null,null,null,g.T,g.m)),o.Bb(37,49152,null,0,i.H,[o.j,o.p,o.F],{loadingSpinner:[0,"loadingSpinner"]},null)],(function(n,l){var t=l.component;n(l,6,0,"ios"),n(l,10,0,""),n(l,19,0,"",""),n(l,21,0,"settings-left-label"),n(l,25,0,"settings-right-label"),n(l,28,0,"210px",t.coupons),n(l,35,0,"100px"),n(l,37,0,"bubbles")}),(function(n,l){var t=l.component;n(l,14,0,o.Wb(l,14,0,o.Ob(l,15).transform("coupon.coupon"))),n(l,22,0,o.Wb(l,22,0,o.Ob(l,23).transform("global.region"))),n(l,26,0,t.regionText)}))}function v(n){return o.Xb(0,[(n()(),o.Cb(0,0,null,null,1,"app-coupons",[],null,null,null,m,f)),o.Bb(1,114688,null,0,b,[u.a,i.Jb,c.a,h.k,x.b,o.F],null,null)],(function(n,l){n(l,1,0)}),null)}var k=o.yb("app-coupons",b,v,{},{},[]),w=t("s7LF"),y=t("iInd");t.d(l,"CouponsPageModuleNgFactory",(function(){return M}));var M=o.zb(a,[],(function(n){return o.Lb([o.Mb(512,o.m,o.kb,[[8,[p.a,k]],[3,o.m],o.D]),o.Mb(4608,d.n,d.m,[o.z,[2,d.z]]),o.Mb(4608,w.j,w.j,[]),o.Mb(4608,i.c,i.c,[o.F,o.g]),o.Mb(4608,i.Ib,i.Ib,[i.c,o.m,o.w]),o.Mb(4608,i.Nb,i.Nb,[i.c,o.m,o.w]),o.Mb(4608,h.g,h.f,[]),o.Mb(4608,h.c,h.e,[]),o.Mb(4608,h.i,h.d,[]),o.Mb(4608,h.b,h.a,[]),o.Mb(4608,h.k,h.k,[h.l,h.g,h.c,h.i,h.b,h.m,h.n]),o.Mb(1073742336,d.b,d.b,[]),o.Mb(1073742336,w.i,w.i,[]),o.Mb(1073742336,w.b,w.b,[]),o.Mb(1073742336,i.Fb,i.Fb,[]),o.Mb(1073742336,h.h,h.h,[]),o.Mb(1073742336,y.o,y.o,[[2,y.t],[2,y.m]]),o.Mb(1073742336,a,a,[]),o.Mb(256,h.n,void 0,[]),o.Mb(256,h.m,void 0,[]),o.Mb(1024,y.k,(function(){return[[{path:"",component:b}]]}),[])])}))}}]);