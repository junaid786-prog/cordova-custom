(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{M3uO:function(t,e,i){"use strict";i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return a}));var n=i("mrSG"),s=i("yYM5");const c="hrTypeWearFit";class a extends s.d{constructor(t,e){super(t,e),this.onWearFitConnected=t=>{if(void 0===this.notifySubcription){const e=this.getIdFromPeripheralData(t),i=this.getNotifyCharacteristicUUIDFromPeripheralData(t);null!=i&&(this.notifySubcription=this.ble.startNotification(e,this.serviceUUID,i).subscribe(t=>{const e=new Uint8Array(t);171==e[0]&&49==e[4]&&10==e[5]&&this.events.publish(s.c,{heartRate:e[6]})}))}},this.onWearFitDisconnected=()=>{void 0!==this.notifySubcription&&(this.notifySubcription.unsubscribe(),this.notifySubcription=void 0)},this.connect=t=>n.b(this,void 0,void 0,(function*(){return this.connectInternal(t,t=>{this.onWearFitConnected(t)},t=>{this.onWearFitDisconnected()})})),this.disconnect=()=>n.b(this,void 0,void 0,(function*(){try{return yield this.disconnectInternal(this.activePeripheralData,()=>{this.onWearFitDisconnected()})}catch(t){throw t}})),this.type=c,this.serviceUUID="6E400001-B5A3-F393-E0A9-E50E24DCCA9E"}autoConnect(){return n.b(this,void 0,void 0,(function*(){try{return yield this.autoConnectInternal(t=>{this.onWearFitConnected(t)},t=>{this.onWearFitDisconnected()}),!0}catch(t){console.log(t)}return!1}))}startHeartRateStreaming(){return n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.activePeripheralData){const t=this.getWriteCharacteristicUUIDFromPeripheralData(this.activePeripheralData);if(void 0!==t){const e=this.getIdFromPeripheralData(this.activePeripheralData);let i=new Uint8Array(7);i[0]=171,i[1]=0,i[2]=4,i[3]=255,i[4]=49,i[5]=10,i[6]=1,yield this.ble.writeWithoutResponse(e,this.serviceUUID,t,i.buffer)}else console.log("WearFit.startHeartRateStreaming() can't find writeCharacteristicUUID");return!0}}catch(t){console.log(`WearFit.startHeartRateStreaming() ${t}`)}return!1}))}stopHeartRateStreaming(){return n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.activePeripheralData){const t=this.getWriteCharacteristicUUIDFromPeripheralData(this.activePeripheralData);if(void 0!==t){const e=this.getIdFromPeripheralData(this.activePeripheralData);let i=new Uint8Array(7);i[0]=171,i[1]=0,i[2]=4,i[3]=255,i[4]=49,i[5]=10,i[6]=0,yield this.ble.write(e,this.serviceUUID,t,i.buffer)}else console.log("WearFit.stopHeartRateStreaming() can't find writeCharacteristicUUID");return!0}}catch(t){console.log(`WearFit.stopHeartRateStreaming() ${t}`)}return!1}))}}},cPjO:function(t,e,i){"use strict";var n=i("mrSG"),s=i("ZZ/e"),c=i("zP/x"),a=i("M3uO"),o=i("yYM5");const r="hrTypeUTE";class h extends o.d{constructor(t,e){super(t,e),this.startScan=t=>n.b(this,void 0,void 0,(function*(){try{return!this.isConnecting()&&(yield this.stopScan(),new Promise((e,i)=>{this.scanDeviceCallback=t,cordova.plugins.UTEPlugin.startScan(()=>{this.bScanningDevice=!0,e(!0)},t=>{this.scanDeviceCallback=void 0,console.log("UteWatch.startScan() failed => "+JSON.stringify(t)),i(t)})}))}catch(e){throw e}})),this.stopScan=()=>n.b(this,void 0,void 0,(function*(){return!this.isConnecting()&&new Promise((t,e)=>{cordova.plugins.UTEPlugin.stopScan(()=>{this.bScanningDevice=!1,this.scanDeviceCallback=void 0,t(!0)},t=>{console.log("UteWatch.stopScan() failed => "+JSON.stringify(t)),e(t)})})})),this.isScanning=()=>this.bScanningDevice,this.connect=t=>n.b(this,void 0,void 0,(function*(){return new Promise((e,i)=>{cordova.plugins.UTEPlugin.connect(t,()=>{this.bConnectingDevice=!0,e(!0)},t=>{console.log("UteWatch.connect() failed => "+JSON.stringify(t)),i(t)})})})),this.disconnect=()=>n.b(this,void 0,void 0,(function*(){return new Promise((t,e)=>{cordova.plugins.UTEPlugin.disconnect(()=>{this.bConnectingDevice=!0,this.setLastDeviceId(""),t(!0)},t=>{console.log("UteWatch.connect() failed => "+JSON.stringify(t)),e(t)})})})),this.autoConnect=()=>n.b(this,void 0,void 0,(function*(){return""!=this.getLastDeviceId()&&!this.isConnected()&&!this.isConnecting()&&(this.startScan(t=>{t.id==this.getLastDeviceId()&&this.connect(t.id)}),!0)})),this.isConnecting=()=>this.bConnectingDevice,this.isConnected=()=>void 0!==this.connectedDeviceId,this.getConnectedDeviceName=()=>void 0!==this.connectedDeviceName?this.connectedDeviceName:null,this.getConnectedDeviceId=()=>void 0!==this.connectedDeviceId?this.connectedDeviceId:null,this.startHeartRateStreaming=()=>{this.bHeartRateOn=!0,setTimeout(()=>{cordova.plugins.UTEPlugin.startHeartRateStreaming(()=>{},t=>{console.log("UteWatch.startHeartRateStreaming() failed => "+JSON.stringify(t))})},1e3)},this.stopHeartRateStreaming=()=>{cordova.plugins.UTEPlugin.stopHeartRateStreaming(()=>{this.bHeartRateOn=!1},t=>{console.log("UteWatch.stopHeartRateStreaming() failed => "+JSON.stringify(t))})},this.onDeviceFound=t=>{void 0!==this.scanDeviceCallback&&this.scanDeviceCallback(t)},this.onDeviceConnected=t=>{this.connectedDeviceName=t.name,this.connectedDeviceId=t.id,this.bConnectingDevice=!1,this.events.publish(o.a,t)},this.onDeviceDisconnected=t=>{console.log("UteWatch.onDeviceDisconnected => "+JSON.stringify(t));let e=this.connectedDeviceName;void 0===e&&(e="");let i=this.connectedDeviceId;void 0===i&&(i=""),this.connectedDeviceName=void 0,this.connectedDeviceId=void 0;let n=!1;this.bConnectingDevice&&(this.bConnectingDevice=!1,n=!0),this.events.publish(o.b,{name:e,id:i,type:this.type,manual:n})},this.onHeartRateStateChanged=t=>{console.log("UteWatch.onHeartRateStateChanged => "+JSON.stringify(t))},this.onHeartRateChanged=t=>{console.log("UteWatch.onHeartRateChanged => "+JSON.stringify(t)),this.events.publish(o.c,{heartRate:t.hr})},this.type=r,this.bScanningDevice=!1,this.bConnectingDevice=!1,this.bHeartRateOn=!1,window.addEventListener("uteOnDeviceFound",this.onDeviceFound,!1),window.addEventListener("uteOnConnected",this.onDeviceConnected,!1),window.addEventListener("uteOnDisconnected",this.onDeviceDisconnected,!1),window.addEventListener("uteOnHeartRateStateChanged",this.onHeartRateStateChanged,!1),window.addEventListener("uteOnHeartRateChanged",this.onHeartRateChanged,!1)}}var d=i("8Y7J"),v=i("xgBC");i.d(e,"a",(function(){return p}));const l="HeartRateDevice",u="LastDeviceId",D=3e4;var g=function(t){return t[t.Wearfit=0]="Wearfit",t[t.UteWatch=1]="UteWatch",t}({});let p=(()=>{class t{constructor(t,e,i,s){this.ble=t,this.events=e,this.platform=i,this.storage=s,this.autoConnectTimer=null,this.getKey=t=>l+"-"+t,this.selectDevice=t=>{t==g.Wearfit?this.heartRateDevice=new a.b(this.ble,this.events):t==g.UteWatch&&(this.heartRateDevice=new h(this.ble,this.events))},this.startScan=t=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.heartRateDevice)return yield this.heartRateDevice.startScan(t)}catch(e){console.log(e)}return!1})),this.stopScan=()=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.heartRateDevice)return yield this.heartRateDevice.stopScan()}catch(t){console.log(t)}return!1})),this.connect=t=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.heartRateDevice)return yield this.heartRateDevice.connect(t)}catch(e){console.log(e)}return!1})),this.autoConnect=()=>{void 0!==this.heartRateDevice&&""!=this.heartRateDevice.getLastDeviceId()&&(this.heartRateDevice.autoConnect(),this.autoConnectTimer=setTimeout(()=>{this.autoConnect()},D))},this.stopAutoConnect=()=>{null!=this.autoConnectTimer&&(clearTimeout(this.autoConnectTimer),this.autoConnectTimer=null)},this.disconnect=()=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.heartRateDevice)return yield this.heartRateDevice.disconnect()}catch(t){console.log(t)}return!1})),this.startHeartRateStreaming=()=>{void 0!==this.heartRateDevice&&this.heartRateDevice.startHeartRateStreaming()},this.stopHeartRateStreaming=()=>{void 0!==this.heartRateDevice&&this.heartRateDevice.stopHeartRateStreaming()},this.getLastDeviceId=()=>void 0!==this.heartRateDevice?this.heartRateDevice.getLastDeviceId():null,this.setLastDeviceId=t=>{void 0!==this.heartRateDevice&&this.heartRateDevice.setLastDeviceId(t)},this.isScanning=()=>void 0!==this.heartRateDevice&&this.heartRateDevice.isScanning(),this.isConnecting=()=>void 0!==this.heartRateDevice&&this.heartRateDevice.isConnecting(),this.isConnected=()=>!!this.platform.is("desktop")||void 0!==this.heartRateDevice&&this.heartRateDevice.isConnected(),this.getConnectedDeviceName=()=>this.platform.is("desktop")?"M4":void 0!==this.heartRateDevice?this.heartRateDevice.getConnectedDeviceName():null,this.getConnectedDeviceId=()=>this.platform.is("desktop")?"7258DFA7-356D-0C83-83CD-F11F366CD210":void 0!==this.heartRateDevice?this.heartRateDevice.getConnectedDeviceName():null,this.heartRateDeviceConnected=t=>n.b(this,void 0,void 0,(function*(){try{const e=t.id;yield this.storage.set(this.getKey(u),e),this.stopAutoConnect()}catch(e){console.log(e)}})),this.heartRateDeviceDisconnected=t=>n.b(this,void 0,void 0,(function*(){try{Boolean(t.manual)?yield this.storage.set(this.getKey(u),""):this.autoConnect()}catch(e){console.log(e)}})),this.platform.ready().then(()=>n.b(this,void 0,void 0,(function*(){try{this.events.subscribe(o.a,this.heartRateDeviceConnected),this.events.subscribe(o.b,this.heartRateDeviceDisconnected),this.selectDevice(g.UteWatch);const t=yield this.storage.get(this.getKey(u));null!=t&&(this.setLastDeviceId(t),this.autoConnect())}catch(t){console.log(t)}})))}}return t.ngInjectableDef=d.ac({factory:function(){return new t(d.bc(c.a),d.bc(s.f),d.bc(s.Mb),d.bc(v.b))},token:t,providedIn:"root"}),t})()},yYM5:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return c})),i.d(e,"c",(function(){return a})),i.d(e,"d",(function(){return r}));var n=i("mrSG");const s="evtHRDevConnected",c="evtHRDevDisconnected",a="evtHRDevHeartRateChanged",o="hrTypeUnknown";class r{constructor(t,e){this.startScan=t=>n.b(this,void 0,void 0,(function*(){return void 0===this.scanSubscription&&(this.scanSubscription=this.ble.startScan([]).subscribe(e=>{"name"in e&&void 0!==t&&t(e)}),!0)})),this.stopScan=()=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==this.scanSubscription)return yield this.ble.stopScan(),this.scanSubscription.unsubscribe(),this.scanSubscription=void 0,!0}catch(t){console.log(`HeartRateDevice.stopScan() ${t}`)}return!1})),this.onConnected=(t,e,i)=>{this.getServicesFromPeripheralData(t).map(t=>t.toUpperCase()).includes(this.serviceUUID)?(this.bConnecting=!1,this.activePeripheralData=t,this.setLastDeviceId(this.getIdFromPeripheralData(t)),void 0!==e&&e(t),this.events.publish(s,{id:this.getIdFromPeripheralData(t),name:this.getNameFromPeripheralData(t)})):(console.log(`HR connected but service UUID not matched : ${JSON.stringify(t)}`),this.disconnectInternal(t,i))},this.onDisconnected=(t,e,i)=>{this.bConnecting=!1,this.activePeripheralData=void 0,e&&this.setLastDeviceId(""),void 0!==this.connectSubscription&&(this.connectSubscription.unsubscribe(),this.connectSubscription=void 0),void 0!==i&&i();const n=this.getNameFromPeripheralData(t),s=this.getIdFromPeripheralData(t);this.events.publish(c,{id:s,name:n,type:this.type,manual:e})},this.connect=t=>n.b(this,void 0,void 0,(function*(){return this.connectInternal(t)})),this.autoConnectInternal=(t,e)=>n.b(this,void 0,void 0,(function*(){try{if(this.disconnect(),""!==this.lastDeviceId)return yield this.getConnectedPeripheral(this.lastDeviceId),this.ble.autoConnect(this.lastDeviceId,i=>{this.onConnected(i,t,e)},t=>{this.onDisconnected(t,!1,e)}),!0}catch(i){console.log(i)}return!1})),this.disconnectInternal=(t,e)=>n.b(this,void 0,void 0,(function*(){try{if(void 0!==t){const i=this.getIdFromPeripheralData(t);return null!=i&&(this.bConnecting=!0,yield this.ble.disconnect(i),this.onDisconnected(t,!0,e)),!0}return!1}catch(i){console.log(`HeartRateDevice.disconnect() ${i}`)}})),this.disconnect=()=>n.b(this,void 0,void 0,(function*(){try{return this.disconnectInternal(this.activePeripheralData)}catch(t){throw t}})),this.getConnectedPeripheral=t=>n.b(this,void 0,void 0,(function*(){try{const e=yield this.ble.peripheralsWithIdentifiers([t]);if(1==e.length)return e[0]}catch(e){console.log(`HeartRateDevice.isPeripheralConnected() ${e}`)}return null})),this.isScanning=()=>void 0!==this.scanSubscription,this.isConnecting=()=>this.bConnecting,this.isConnected=()=>void 0!==this.activePeripheralData,this.getConnectedDeviceName=()=>{if(void 0!==this.activePeripheralData){const t=this.getNameFromPeripheralData(this.activePeripheralData);return void 0!==t?t:null}return null},this.getConnectedDeviceId=()=>{if(void 0!==this.activePeripheralData){const t=this.getIdFromPeripheralData(this.activePeripheralData);return void 0!==t?t:null}return null},this.getLastDeviceId=()=>this.lastDeviceId,this.setLastDeviceId=t=>{null==t&&(t=""),this.lastDeviceId=t},this.getServicesFromPeripheralData=t=>t.services,this.getIdFromPeripheralData=t=>t.id,this.getNameFromPeripheralData=t=>t.name,this.getNotifyCharacteristicUUIDFromPeripheralData=t=>{const e=t.characteristics;for(let i of e){const t=i.service;if(i.properties.includes("Notify")&&void 0!==t&&t.toUpperCase()==this.serviceUUID&&void 0!==i.characteristic)return i.characteristic}return console.log(`HeartRateDevice.getNotifyCharacteristicUUIDFromPeripheralData() not able to get notify characteristic ${JSON.stringify(t)}`),null},this.getWriteCharacteristicUUIDFromPeripheralData=t=>{const e=t.characteristics;for(let i of e){const t=i.service;if(i.properties.includes("Write")&&void 0!==t&&t.toUpperCase()==this.serviceUUID&&void 0!==i.characteristic)return i.characteristic}return console.log(`HeartRateDevice.getWriteCharacteristicUUIDFromPeripheralData() not able to get notify characteristic ${JSON.stringify(t)}`),null},this.ble=t,this.events=e,this.type=o,this.lastDeviceId="",this.bConnecting=!1}connectInternal(t,e,i){return void 0===this.connectSubscription&&(this.bConnecting=!0,this.connectSubscription=this.ble.connect(t).subscribe(t=>{this.onConnected(t,e,i)},t=>{this.onDisconnected(t,!1,i)}),!0)}autoConnect(){return n.b(this,void 0,void 0,(function*(){try{return yield this.autoConnectInternal()}catch(t){console.log(t)}return!1}))}startHeartRateStreaming(){}stopHeartRateStreaming(){}}}}]);